{"version":3,"file":"useVirtualScroll.js","sources":["../../../components/hooks/useVirtualScroll.ts"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\n/**\n * 通用虚拟滚动，可支持 Select/List/Table/TreeSelect/Cascader 等组件\n */\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { isEqual } from 'lodash-es';\nimport type { ScrollToElementParams, TScroll } from '../common';\n\nexport type UseVirtualScrollParams = {\n  enable?: boolean;\n  data: { [key: string]: any }[];\n  scroll: TScroll & {\n    fixedRows?: Array<number>;\n  };\n};\n\nexport type RowMountedParams = {\n  ref: HTMLElement;\n  data: {\n    [key: string]: any;\n    __VIRTUAL_SCROLL_INDEX?: number;\n  };\n};\n\nconst requestAnimationFrame =\n  (typeof window === 'undefined' ? false : window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\nconst useVirtualScroll = (container: React.MutableRefObject<HTMLElement>, params: UseVirtualScrollParams) => {\n  const { enable = true, data, scroll } = params;\n\n  const dataRef = useRef(data);\n  const containerHeight = useRef(0);\n\n  /** 注意测试：数据长度为空；数据长度小于表格高度等情况。即期望只有数据量达到一定程度才允许开启虚拟滚动 */\n  const [visibleData, setVisibleData] = useState<any[]>([]);\n  // 滚动过程中表格顶部占位距离\n  const [translateY, setTranslateY] = useState(0);\n  // 滚动高度，用于显示滚动条\n  const [scrollHeight, setScrollHeight] = useState(0);\n  // 每一行到顶部的距离总和\n  const trScrollTopHeightList = useRef<number[]>([]);\n  // 每一行的实际高度\n  const [trHeightList, setTrHeightList] = useState<number[]>([]);\n\n  const tScroll = useMemo(() => {\n    if (!scroll) return {};\n    return {\n      bufferSize: scroll.bufferSize || 10,\n      isFixedRowHeight: scroll.isFixedRowHeight ?? false,\n      rowHeight: scroll.rowHeight || 47,\n      threshold: scroll.threshold || 100,\n      type: scroll.type,\n      fixedRows: scroll.fixedRows ?? [0, 0],\n    };\n  }, [scroll]);\n\n  const enableVirtualScroll = useMemo(() => enable && tScroll.type === 'virtual', [enable, tScroll]);\n  const isVirtualScroll = useMemo(\n    () => enableVirtualScroll && tScroll.threshold < data.length,\n    [enableVirtualScroll, tScroll.threshold, data.length],\n  );\n\n  const visibleCount = Math.min(tScroll.bufferSize * 3, data.length);\n  const [startAndEndIndex, setStartAndEndIndex] = useState<[number, number]>(() => [0, visibleCount]);\n\n  const getTrScrollTopHeightList = (trHeightList: number[]) => {\n    const list: number[] = [];\n    // 大数据场景不建议使用 forEach 一类函数迭代\n    // 当前行滚动高度 = 上一行滚动高度 + 当前行高度\n    for (let i = 0, len = data.length; i < len; i++) {\n      list[i] = (list[i - 1] || 0) + (trHeightList[i] || tScroll.rowHeight);\n    }\n    return list;\n  };\n\n  const updateVisibleData = (trScrollTopHeightList: number[], scrollTop: number) => {\n    let currentIndex = -1;\n    // 获取当前滚动到哪一个元素（大数据场景不建议使用 forEach 一类函数迭代）\n    for (let i = 0, len = trScrollTopHeightList.length; i < len; i++) {\n      if (trScrollTopHeightList[i] >= scrollTop) {\n        currentIndex = i;\n        break;\n      }\n    }\n    let lastIndex = trScrollTopHeightList.length;\n    const containerCurrentHeight = containerHeight.current || container.current.getBoundingClientRect().height;\n    const scrollBottom = scrollTop + containerCurrentHeight;\n    // 获取当前视窗的最后一个元素（大数据场景不建议使用 forEach 一类函数迭代）\n    for (let i = currentIndex, len = trScrollTopHeightList.length; i < len; i++) {\n      if (trScrollTopHeightList[i] >= scrollBottom) {\n        lastIndex = i;\n        break;\n      }\n    }\n\n    if (currentIndex < 0) return;\n    const startIndex = Math.max(currentIndex - tScroll.bufferSize, 0);\n    const endIndex = Math.min(lastIndex + tScroll.bufferSize, trScrollTopHeightList.length);\n\n    // 计算固定行情况\n    const { fixedRows } = tScroll;\n    const [fixedStart, fixedEnd] = fixedRows;\n\n    const firstIsFake = data[0]?.__VIRTUAL_FAKE_DATA;\n    const isScrollStart = lastIndex - visibleCount <= 0; // 首行开始出现在可视区域\n    const startOffset = firstIsFake && !isScrollStart ? 1 : 0;\n\n    let fixedStartData = fixedStart ? data.slice(startOffset, fixedStart + startOffset) : [];\n    if (fixedStart && startIndex < fixedStart) {\n      fixedStartData = fixedStartData.slice(0, startIndex);\n    }\n\n    const lastIsFake = data[data.length - 1]?.__VIRTUAL_FAKE_DATA;\n    const isScrollEnd = lastIndex === trScrollTopHeightList.length;\n    const endOffset = lastIsFake && !isScrollEnd ? 1 : 0;\n\n    let fixedEndData = fixedEnd ? data.slice(data.length - fixedEnd - endOffset) : [];\n    const bottomStartIndex = endIndex - data.length + 1 + (fixedEnd ?? 0);\n    if (fixedEnd && bottomStartIndex > 0) {\n      fixedEndData = fixedEndData.slice(bottomStartIndex);\n    }\n\n    if (startAndEndIndex.join() !== [startIndex, endIndex].join() && startIndex >= 0) {\n      const tmpVisibleData = fixedStartData.concat(data.slice(startIndex, endIndex)).concat(fixedEndData);\n      setVisibleData(tmpVisibleData);\n      const lastScrollTop = trScrollTopHeightList[startIndex - 1];\n      const top = lastScrollTop > 0 ? lastScrollTop : 0;\n      const stickyHeight = trScrollTopHeightList[Math.min(startIndex, fixedStart) - 1] || 0;\n      setTranslateY(top - stickyHeight);\n      setStartAndEndIndex([startIndex, endIndex]);\n    }\n  };\n\n  // 仅非固定高度场景需要\n  const handleRowMounted = (rowData: RowMountedParams) => {\n    if (!isVirtualScroll || !rowData || tScroll.isFixedRowHeight || !container?.current) return;\n    const trHeight = rowData.ref.offsetHeight;\n    const rowIndex = rowData.data.__VIRTUAL_SCROLL_INDEX;\n    const newTrHeightList = trHeightList;\n    if (newTrHeightList[rowIndex] !== trHeight) {\n      newTrHeightList[rowIndex] = trHeight;\n      setTrHeightList(newTrHeightList);\n\n      const scrollTopHeightList = getTrScrollTopHeightList(newTrHeightList);\n      trScrollTopHeightList.current = scrollTopHeightList;\n\n      const lastIndex = scrollTopHeightList.length - 1;\n      setScrollHeight(scrollTopHeightList[lastIndex] - containerHeight.current);\n      updateVisibleData(scrollTopHeightList, container.current.scrollTop);\n    }\n  };\n\n  const handleScroll = () => {\n    if (!isVirtualScroll) return;\n    updateVisibleData(trScrollTopHeightList.current, container.current.scrollTop);\n  };\n\n  const addIndexToData = (data: any[]) => {\n    data.forEach((item, index) => {\n      Reflect.set(item, '__VIRTUAL_SCROLL_INDEX', index);\n    });\n  };\n\n  const updateScrollTop = ({ index, top = 0, behavior }: ScrollToElementParams) => {\n    const scrollTop = trScrollTopHeightList.current[index] - top;\n    container.current?.scrollTo({\n      top: scrollTop,\n      behavior: behavior || 'auto',\n    });\n  };\n\n  /**\n   * 滚动到指定元素（对外暴露的方法，谨慎修改）\n   */\n  const scrollToElement = (p: ScrollToElementParams) => {\n    updateScrollTop(p);\n    if (!tScroll.isFixedRowHeight) {\n      requestAnimationFrame(() => {\n        const duration = p.time ?? 60;\n        const timer = setTimeout(() => {\n          updateScrollTop(p);\n          clearTimeout(timer);\n        }, duration);\n      });\n    }\n  };\n\n  // 固定高度场景，可直接通过数据长度计算出最大滚动高度\n  useEffect(\n    () => {\n      if (!enableVirtualScroll) return;\n\n      if (!isVirtualScroll) {\n        if (!data.length) return;\n        // 避免从非虚拟滚动切换到虚拟滚动时，数据瞬间为[]，导致滚动位置重置的问题\n        setVisibleData(data);\n        dataRef.current = data;\n        trScrollTopHeightList.current = getTrScrollTopHeightList(trHeightList);\n        return;\n      }\n\n      // 给数据添加下标\n      addIndexToData(data);\n\n      const dataChanged = !isEqual(dataRef.current, data);\n      const scrollTopHeightList = trScrollTopHeightList.current;\n      if (scrollTopHeightList?.length === data?.length && !dataChanged) {\n        // 正常滚动时更新可见数据\n        const lastIndex = scrollTopHeightList.length - 1;\n        setScrollHeight(scrollTopHeightList[lastIndex]);\n        updateVisibleData(scrollTopHeightList, container.current.scrollTop);\n      } else {\n        /**\n        /* 进入这个分支的场景可能有：\n         * - 初始化\n         * - 外部数据动态更新（长度变化、内容结构变化等）\n         */\n        dataRef.current = data;\n        setScrollHeight(data.length * tScroll.rowHeight);\n\n        // 如果之前存在滚动，基于原先数据计算位置\n        const currentScrollTop = container.current?.scrollTop || 0;\n        let currentIndex = Math.floor(currentScrollTop / tScroll.rowHeight);\n        for (let i = 0; i < scrollTopHeightList?.length; i++) {\n          if (scrollTopHeightList[i] >= currentScrollTop) {\n            currentIndex = i;\n            break;\n          }\n        }\n\n        const startIndex = Math.max(currentIndex - tScroll.bufferSize, 0);\n        const endIndex = Math.min(startIndex + visibleCount, data.length);\n        const tmpData = data.slice(startIndex, endIndex);\n\n        let translateY = startIndex * tScroll.rowHeight;\n\n        if (scrollTopHeightList?.length > 0 && startIndex > 0) {\n          const prevHeight = scrollTopHeightList[Math.min(startIndex - 1, scrollTopHeightList.length - 1)] || 0;\n          translateY = Math.max(0, prevHeight);\n        }\n\n        setVisibleData(tmpData);\n        setTranslateY(translateY);\n      }\n\n      const timer = setTimeout(() => {\n        if (container.current) {\n          const tmpContainerHeight = container.current.getBoundingClientRect().height;\n          containerHeight.current = tmpContainerHeight;\n          const scrollTopHeightList = getTrScrollTopHeightList(trHeightList);\n          trScrollTopHeightList.current = scrollTopHeightList;\n          clearTimeout(timer);\n        }\n      }, 1);\n    },\n    // eslint-disable-next-line\n    [container, data, tScroll, isVirtualScroll, startAndEndIndex, trHeightList],\n  );\n\n  return {\n    visibleData,\n    translateY,\n    scrollHeight,\n    isVirtualScroll,\n    handleScroll,\n    handleRowMounted,\n    scrollToElement,\n  };\n};\n\nexport type VirtualScrollConfig = ReturnType<typeof useVirtualScroll>;\n\nexport default useVirtualScroll;\n"],"names":["requestAnimationFrame","window","cb","setTimeout","useVirtualScroll","container","params","_params$enable","enable","data","scroll","dataRef","useRef","containerHeight","_useState","useState","_useState2","_slicedToArray","visibleData","setVisibleData","_useState3","_useState4","translateY","setTranslateY","_useState5","_useState6","scrollHeight","setScrollHeight","trScrollTopHeightList","_useState7","_useState8","trHeightList","setTrHeightList","tScroll","useMemo","_scroll$isFixedRowHei","_scroll$fixedRows","bufferSize","isFixedRowHeight","rowHeight","threshold","type","fixedRows","enableVirtualScroll","isVirtualScroll","length","visibleCount","Math","min","_useState9","_useState0","startAndEndIndex","setStartAndEndIndex","getTrScrollTopHeightList","list","i","len","updateVisibleData","scrollTop","_data$","_data","currentIndex","lastIndex","containerCurrentHeight","current","getBoundingClientRect","height","scrollBottom","startIndex","max","endIndex","_fixedRows","fixedStart","fixedEnd","firstIsFake","__VIRTUAL_FAKE_DATA","isScrollStart","startOffset","fixedStartData","slice","lastIsFake","isScrollEnd","endOffset","fixedEndData","bottomStartIndex","join","tmpVisibleData","concat","lastScrollTop","top","stickyHeight","handleRowMounted","rowData","trHeight","ref","offsetHeight","rowIndex","__VIRTUAL_SCROLL_INDEX","newTrHeightList","scrollTopHeightList","handleScroll","addIndexToData","forEach","item","index","Reflect","set","updateScrollTop","_container$current","_ref$top","behavior","scrollTo","scrollToElement","p","_p$time","duration","time","timer","clearTimeout","useEffect","dataChanged","isEqual","_container$current2","currentScrollTop","floor","tmpData","prevHeight","tmpContainerHeight"],"mappings":";;;;;;;;;;;AAwBA,IAAMA,qBAAA,GAAA,CACH,OAAOC,MAAA,KAAW,WAAc,GAAA,KAAA,GAAQA,MAAO,CAAAD,qBAAA,KAA2B,UAACE,EAAA,EAAA;AAAA,EAAA,OAAOC,UAAW,CAAAD,EAAA,EAAI,IAAI,CAAA,CAAA;AAAA,CAAA,CAAA;AAElGE,IAAAA,gBAAA,GAAmB,SAAnBA,gBAAAA,CAAoBC,SAAA,EAAgDC,MAAmC,EAAA;AAC3G,EAAA,IAAAC,cAAA,GAAwCD,MAAA,CAAhCE,MAAA;AAAAA,IAAAA,MAAA,GAAAD,cAAA,KAAS,KAAA,CAAA,GAAA,IAAM,GAAAA,cAAA;IAAAE,IAAA,GAAiBH,MAAA,CAAjBG,IAAA;IAAMC,SAAWJ,MAAA,CAAXI;AAEvB,EAAA,IAAAC,OAAA,GAAUC,OAAOH,IAAI,CAAA,CAAA;AACrB,EAAA,IAAAI,eAAA,GAAkBD,OAAO,CAAC,CAAA,CAAA;AAGhC,EAAA,IAAAE,SAAA,GAAsCC,QAAA,CAAgB,EAAE,CAAA;IAAAC,UAAA,GAAAC,cAAA,CAAAH,SAAA,EAAA,CAAA,CAAA;AAAjDI,IAAAA,WAAa,GAAAF,UAAA,CAAA,CAAA,CAAA;AAAAG,IAAAA,cAAc,GAAAH,UAAA,CAAA,CAAA,CAAA,CAAA;AAElC,EAAA,IAAAI,UAAA,GAAoCL,SAAS,CAAC,CAAA;IAAAM,UAAA,GAAAJ,cAAA,CAAAG,UAAA,EAAA,CAAA,CAAA;AAAvCE,IAAAA,UAAA,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAYE,IAAAA,aAAa,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAEhC,EAAA,IAAAG,UAAA,GAAwCT,SAAS,CAAC,CAAA;IAAAU,UAAA,GAAAR,cAAA,CAAAO,UAAA,EAAA,CAAA,CAAA;AAA3CE,IAAAA,YAAA,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAcE,IAAAA,eAAe,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAE9B,EAAA,IAAAG,qBAAA,GAAwBhB,MAAiB,CAAA,EAAE,CAAA,CAAA;AAEjD,EAAA,IAAAiB,UAAA,GAAwCd,QAAA,CAAmB,EAAE,CAAA;IAAAe,UAAA,GAAAb,cAAA,CAAAY,UAAA,EAAA,CAAA,CAAA;AAAtDE,IAAAA,YAAc,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAAE,IAAAA,eAAe,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAE9B,EAAA,IAAAG,OAAA,GAAUC,QAAQ,YAAM;IAAA,IAAAC,qBAAA,EAAAC,iBAAA,CAAA;AAC5B,IAAA,IAAI,CAAC1B,MAAA,EAAQ,OAAO,EAAC,CAAA;IACd,OAAA;AACL2B,MAAAA,UAAA,EAAY3B,OAAO2B,UAAc,IAAA,EAAA;MACjCC,gBAAA,EAAA,CAAAH,qBAAA,GAAkBzB,OAAO4B,gBAAoB,MAAA,IAAA,IAAAH,qBAAA,KAAA,KAAA,CAAA,GAAAA,qBAAA,GAAA,KAAA;AAC7CI,MAAAA,SAAA,EAAW7B,OAAO6B,SAAa,IAAA,EAAA;AAC/BC,MAAAA,SAAA,EAAW9B,OAAO8B,SAAa,IAAA,GAAA;MAC/BC,MAAM/B,MAAO,CAAA+B,IAAA;AACbC,MAAAA,SAAW,EAAAN,CAAAA,iBAAA,GAAA1B,MAAA,CAAOgC,SAAa,MAAA,IAAA,IAAAN,iBAAA,KAAA,KAAA,CAAA,GAAAA,iBAAA,GAAA,CAAC,GAAG,CAAC,CAAA;KACtC,CAAA;AACF,GAAA,EAAG,CAAC1B,MAAM,CAAC,CAAA,CAAA;EAEL,IAAAiC,mBAAA,GAAsBT,OAAQ,CAAA,YAAA;AAAA,IAAA,OAAM1B,MAAU,IAAAyB,OAAA,CAAQQ,SAAS,SAAW,CAAA;AAAA,GAAA,EAAA,CAACjC,MAAQ,EAAAyB,OAAO,CAAC,CAAA,CAAA;EACjG,IAAMW,eAAkB,GAAAV,OAAA,CACtB,YAAA;IAAA,OAAMS,mBAAA,IAAuBV,OAAQ,CAAAO,SAAA,GAAY/B,IAAK,CAAAoC,MAAA,CAAA;GACtD,EAAA,CAACF,mBAAA,EAAqBV,OAAQ,CAAAO,SAAA,EAAW/B,KAAKoC,MAAM,CACtD,CAAA,CAAA;AAEA,EAAA,IAAMC,eAAeC,IAAK,CAAAC,GAAA,CAAIf,QAAQI,UAAa,GAAA,CAAA,EAAG5B,KAAKoC,MAAM,CAAA,CAAA;EAC3D,IAAAI,UAAA,GAA0ClC,SAA2B,YAAA;AAAA,MAAA,OAAM,CAAC,CAAG,EAAA+B,YAAY,CAAC,CAAA;KAAA,CAAA;IAAAI,UAAA,GAAAjC,cAAA,CAAAgC,UAAA,EAAA,CAAA,CAAA;AAA3FE,IAAAA;AAAkBC,IAAAA,mBAAmB,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAEtC,EAAA,IAAAG,wBAAA,GAA2B,SAA3BA,wBAAAA,CAA4BtB,aAA2B,EAAA;IAC3D,IAAMuB,OAAiB,EAAC,CAAA;AAGxB,IAAA,KAAA,IAASC,IAAI,CAAG,EAAAC,GAAA,GAAM/C,KAAKoC,MAAQ,EAAAU,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;MAC/CD,IAAA,CAAKC,MAAMD,IAAK,CAAAC,CAAA,GAAI,MAAM,CAAMxB,KAAAA,aAAAA,CAAawB,MAAMtB,OAAQ,CAAAM,SAAA,CAAA,CAAA;AAC7D,KAAA;AACO,IAAA,OAAAe,IAAA,CAAA;GACT,CAAA;EAEM,IAAAG,iBAAA,GAAoB,SAApBA,iBAAAA,CAAqB7B,sBAAAA,EAAiC8B,SAAsB,EAAA;IAAA,IAAAC,MAAA,EAAAC,KAAA,CAAA;IAChF,IAAIC,YAAe,GAAA,CAAA,CAAA,CAAA;AAEnB,IAAA,KAAA,IAASN,IAAI,CAAG,EAAAC,GAAA,GAAM5B,uBAAsBiB,MAAQ,EAAAU,CAAA,GAAIC,KAAKD,CAAK,EAAA,EAAA;AAC5D3B,MAAAA,IAAAA,sBAAAA,CAAsB2B,MAAMG,SAAW,EAAA;AAC1BG,QAAAA,YAAA,GAAAN,CAAA,CAAA;AACf,QAAA,MAAA;AACF,OAAA;AACF,KAAA;AACA,IAAA,IAAIO,YAAYlC,sBAAsB,CAAAiB,MAAA,CAAA;AACtC,IAAA,IAAMkB,yBAAyBlD,eAAgB,CAAAmD,OAAA,IAAW3D,SAAU,CAAA2D,OAAA,CAAQC,uBAAwB,CAAAC,MAAA,CAAA;AACpG,IAAA,IAAMC,eAAeT,SAAY,GAAAK,sBAAA,CAAA;AAEjC,IAAA,KAAA,IAASR,KAAIM,YAAc,EAAAL,IAAA,GAAM5B,uBAAsBiB,MAAQ,EAAAU,EAAA,GAAIC,MAAKD,EAAK,EAAA,EAAA;AACvE3B,MAAAA,IAAAA,sBAAAA,CAAsB2B,OAAMY,YAAc,EAAA;AAChCL,QAAAA,SAAA,GAAAP,EAAA,CAAA;AACZ,QAAA,MAAA;AACF,OAAA;AACF,KAAA;IAEA,IAAIM,YAAe,GAAA,CAAA,EAAG,OAAA;AACtB,IAAA,IAAMO,aAAarB,IAAK,CAAAsB,GAAA,CAAIR,YAAe,GAAA5B,OAAA,CAAQI,YAAY,CAAC,CAAA,CAAA;AAChE,IAAA,IAAMiC,WAAWvB,IAAK,CAAAC,GAAA,CAAIc,YAAY7B,OAAQ,CAAAI,UAAA,EAAYT,uBAAsBiB,MAAM,CAAA,CAAA;AAGhF,IAAA,IAAEH,YAAcT,OAAA,CAAdS;AACF,IAAA,IAAA6B,UAAA,GAAAtD,cAAA,CAAyByB,SAAA,EAAA,CAAA,CAAA;AAAxB8B,MAAAA,UAAY,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAAE,MAAAA,QAAQ,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAErB,IAAA,IAAAG,WAAA,GAAA,CAAAf,MAAA,GAAclD,KAAK,CAAI,CAAA,MAAAkD,IAAAA,IAAAA,MAAA,KAATA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,MAAA,CAASgB,mBAAA,CAAA;AACvB,IAAA,IAAAC,aAAA,GAAgBd,YAAYhB,YAAgB,IAAA,CAAA,CAAA;IAClD,IAAM+B,WAAc,GAAAH,WAAA,IAAe,CAACE,aAAA,GAAgB,CAAI,GAAA,CAAA,CAAA;AAEpD,IAAA,IAAAE,cAAA,GAAiBN,aAAa/D,IAAK,CAAAsE,KAAA,CAAMF,aAAaL,UAAa,GAAAK,WAAW,IAAI,EAAC,CAAA;AACnF,IAAA,IAAAL,UAAA,IAAcJ,aAAaI,UAAY,EAAA;MACxBM,cAAA,GAAAA,cAAA,CAAeC,KAAM,CAAA,CAAA,EAAGX,UAAU,CAAA,CAAA;AACrD,KAAA;AAEA,IAAA,IAAMY,UAAa,GAAApB,CAAAA,KAAA,GAAAnD,IAAA,CAAKA,IAAK,CAAAoC,MAAA,GAAS,CAAI,CAAA,MAAA,IAAA,IAAAe,KAAA,KAAvBA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,KAAA,CAAuBe,mBAAA,CAAA;AACpC,IAAA,IAAAM,WAAA,GAAcnB,cAAclC,sBAAsB,CAAAiB,MAAA,CAAA;IACxD,IAAMqC,SAAY,GAAAF,UAAA,IAAc,CAACC,WAAA,GAAc,CAAI,GAAA,CAAA,CAAA;AAE/C,IAAA,IAAAE,YAAA,GAAeV,WAAWhE,IAAK,CAAAsE,KAAA,CAAMtE,KAAKoC,MAAS,GAAA4B,QAAA,GAAWS,SAAS,CAAA,GAAI,EAAC,CAAA;AAChF,IAAA,IAAME,gBAAmB,GAAAd,QAAA,GAAW7D,IAAK,CAAAoC,MAAA,GAAS,KAAK4B,QAAY,KAAZA,IAAAA,IAAAA,QAAY,cAAZA,QAAY,GAAA,CAAA,CAAA,CAAA;AAC/D,IAAA,IAAAA,QAAA,IAAYW,mBAAmB,CAAG,EAAA;AACrBD,MAAAA,YAAA,GAAAA,YAAA,CAAaJ,MAAMK,gBAAgB,CAAA,CAAA;AACpD,KAAA;AAEI,IAAA,IAAAjC,gBAAA,CAAiBkC,IAAK,EAAA,KAAM,CAACjB,UAAA,EAAYE,QAAQ,CAAE,CAAAe,IAAA,EAAU,IAAAjB,UAAA,IAAc,CAAG,EAAA;AAC1E,MAAA,IAAAkB,cAAA,GAAiBR,cAAe,CAAAS,MAAA,CAAO9E,IAAK,CAAAsE,KAAA,CAAMX,YAAYE,QAAQ,CAAC,CAAE,CAAAiB,MAAA,CAAOJ,YAAY,CAAA,CAAA;MAClGhE,cAAA,CAAemE,cAAc,CAAA,CAAA;AACvB,MAAA,IAAAE,aAAA,GAAgB5D,uBAAsBwC,UAAa,GAAA,CAAA,CAAA,CAAA;MACnD,IAAAqB,GAAA,GAAMD,aAAgB,GAAA,CAAA,GAAIA,aAAgB,GAAA,CAAA,CAAA;AAChD,MAAA,IAAME,eAAe9D,sBAAsB,CAAAmB,IAAA,CAAKC,IAAIoB,UAAY,EAAAI,UAAU,IAAI,CAAM,CAAA,IAAA,CAAA,CAAA;AACpFjD,MAAAA,aAAA,CAAckE,MAAMC,YAAY,CAAA,CAAA;AACZtC,MAAAA,mBAAA,CAAA,CAACgB,UAAY,EAAAE,QAAQ,CAAC,CAAA,CAAA;AAC5C,KAAA;GACF,CAAA;AAGM,EAAA,IAAAqB,gBAAA,GAAmB,SAAnBA,gBAAAA,CAAoBC,OAA8B,EAAA;AACtD,IAAA,IAAI,CAAChD,eAAmB,IAAA,CAACgD,WAAW3D,OAAQ,CAAAK,gBAAA,IAAoB,EAACjC,SAAW,KAAXA,IAAAA,IAAAA,SAAW,eAAXA,SAAW,CAAA2D,OAAA,CAAS,EAAA,OAAA;AAC/E,IAAA,IAAA6B,QAAA,GAAWD,QAAQE,GAAI,CAAAC,YAAA,CAAA;AACvB,IAAA,IAAAC,QAAA,GAAWJ,QAAQnF,IAAK,CAAAwF,sBAAA,CAAA;IAC9B,IAAMC,eAAkB,GAAAnE,YAAA,CAAA;AACpB,IAAA,IAAAmE,eAAA,CAAgBF,cAAcH,QAAU,EAAA;AAC1CK,MAAAA,eAAA,CAAgBF,QAAY,CAAA,GAAAH,QAAA,CAAA;MAC5B7D,eAAA,CAAgBkE,eAAe,CAAA,CAAA;AAEzB,MAAA,IAAAC,mBAAA,GAAsB9C,yBAAyB6C,eAAe,CAAA,CAAA;MACpEtE,qBAAA,CAAsBoC,OAAU,GAAAmC,mBAAA,CAAA;AAE1B,MAAA,IAAArC,SAAA,GAAYqC,oBAAoBtD,MAAS,GAAA,CAAA,CAAA;MAC/BlB,eAAA,CAAAwE,mBAAA,CAAoBrC,SAAa,CAAA,GAAAjD,eAAA,CAAgBmD,OAAO,CAAA,CAAA;MACtDP,iBAAA,CAAA0C,mBAAA,EAAqB9F,SAAU,CAAA2D,OAAA,CAAQN,SAAS,CAAA,CAAA;AACpE,KAAA;GACF,CAAA;AAEA,EAAA,IAAM0C,eAAe,SAAfA,eAAqB;IACzB,IAAI,CAACxD,eAAA,EAAiB,OAAA;IACtBa,iBAAA,CAAkB7B,qBAAsB,CAAAoC,OAAA,EAAS3D,SAAU,CAAA2D,OAAA,CAAQN,SAAS,CAAA,CAAA;GAC9E,CAAA;AAEM,EAAA,IAAA2C,cAAA,GAAiB,SAAjBA,cAAAA,CAAkB5F,KAAgB,EAAA;AACtCA,IAAAA,KAAK,CAAA6F,OAAA,CAAQ,UAACC,IAAA,EAAMC,KAAU,EAAA;MACpBC,OAAA,CAAAC,GAAA,CAAIH,IAAM,EAAA,wBAAA,EAA0BC,KAAK,CAAA,CAAA;AACnD,KAAC,CAAA,CAAA;GACH,CAAA;AAEA,EAAA,IAAMG,kBAAkB,SAAlBA,sBAA2E;AAAA,IAAA,IAAAC,kBAAA,CAAA;AAAA,IAAA,IAAtDJ,aAAAA;sBAAOf,GAAM;AAANA,MAAAA,GAAM,GAAAoB,QAAA,KAAA,KAAA,CAAA,GAAA,CAAA,GAAAA,QAAA;MAAGC,gBAAAA;IACnC,IAAApD,SAAA,GAAY9B,qBAAsB,CAAAoC,OAAA,CAAQwC,KAAS,CAAA,GAAAf,GAAA,CAAA;IACzD,CAAAmB,kBAAA,GAAAvG,SAAA,CAAU2D,4CAAV4C,KAAAA,CAAAA,IAAAA,kBAAA,CAAmBG,QAAS,CAAA;AAC1BtB,MAAAA,GAAK,EAAA/B,SAAA;MACLoD,UAAUA,QAAY,IAAA,MAAA;AACxB,KAAC,CAAA,CAAA;GACH,CAAA;AAKM,EAAA,IAAAE,eAAA,GAAkB,SAAlBA,eAAAA,CAAmBC,CAA6B,EAAA;IACpDN,eAAA,CAAgBM,CAAC,CAAA,CAAA;AACb,IAAA,IAAA,CAAChF,QAAQK,gBAAkB,EAAA;AAC7BtC,MAAAA,qBAAA,CAAsB,YAAM;AAAA,QAAA,IAAAkH,OAAA,CAAA;AACpB,QAAA,IAAAC,QAAA,GAAA,CAAAD,OAAA,GAAWD,EAAEG,IAAQ,MAAA,IAAA,IAAAF,OAAA,KAAA,KAAA,CAAA,GAAAA,OAAA,GAAA,EAAA,CAAA;AACrB,QAAA,IAAAG,KAAA,GAAQlH,WAAW,YAAM;UAC7BwG,eAAA,CAAgBM,CAAC,CAAA,CAAA;UACjBK,YAAA,CAAaD,KAAK,CAAA,CAAA;WACjBF,QAAQ,CAAA,CAAA;AACb,OAAC,CAAA,CAAA;AACH,KAAA;GACF,CAAA;AAGAI,EAAAA,SAAA,CACE,YAAM;IACJ,IAAI,CAAC5E,mBAAA,EAAqB,OAAA;IAE1B,IAAI,CAACC,eAAiB,EAAA;AACpB,MAAA,IAAI,CAACnC,IAAK,CAAAoC,MAAA,EAAQ,OAAA;MAElB1B,cAAA,CAAeV,IAAI,CAAA,CAAA;MACnBE,OAAA,CAAQqD,OAAU,GAAAvD,IAAA,CAAA;AACImB,MAAAA,qBAAA,CAAAoC,OAAA,GAAUX,yBAAyBtB,YAAY,CAAA,CAAA;AACrE,MAAA,OAAA;AACF,KAAA;IAGAsE,cAAA,CAAe5F,IAAI,CAAA,CAAA;IAEnB,IAAM+G,WAAc,GAAA,CAACC,OAAQ,CAAA9G,OAAA,CAAQqD,SAASvD,IAAI,CAAA,CAAA;AAClD,IAAA,IAAM0F,sBAAsBvE,qBAAsB,CAAAoC,OAAA,CAAA;AAClD,IAAA,IAAI,CAAAmC,mBAAqB,KAAA,IAAA,IAArBA,mBAAqB,KAArBA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,mBAAqB,CAAAtD,MAAA,OAAWpC,IAAM,KAANA,IAAAA,IAAAA,IAAM,uBAANA,IAAM,CAAAoC,MAAA,CAAU,IAAA,CAAC2E,WAAa,EAAA;AAE1D,MAAA,IAAA1D,SAAA,GAAYqC,oBAAoBtD,MAAS,GAAA,CAAA,CAAA;AAC/ClB,MAAAA,eAAA,CAAgBwE,oBAAoBrC,SAAU,CAAA,CAAA,CAAA;MAC5BL,iBAAA,CAAA0C,mBAAA,EAAqB9F,SAAU,CAAA2D,OAAA,CAAQN,SAAS,CAAA,CAAA;AACpE,KAAO,MAAA;AAAA,MAAA,IAAAgE,mBAAA,CAAA;MAML/G,OAAA,CAAQqD,OAAU,GAAAvD,IAAA,CAAA;MACFkB,eAAA,CAAAlB,IAAA,CAAKoC,MAAS,GAAAZ,OAAA,CAAQM,SAAS,CAAA,CAAA;AAGzC,MAAA,IAAAoF,gBAAA,GAAmB,CAAAD,CAAAA,mBAAA,GAAArH,SAAU,CAAA2D,OAAA,MAAA,IAAA,IAAA0D,mBAAA,KAAVA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,mBAAA,CAAmBhE,SAAa,KAAA,CAAA,CAAA;MACzD,IAAIG,YAAe,GAAAd,IAAA,CAAK6E,KAAM,CAAAD,gBAAA,GAAmB1F,QAAQM,SAAS,CAAA,CAAA;AAClE,MAAA,KAAA,IAASgB,CAAI,GAAA,CAAA,EAAGA,CAAI,IAAA4C,mBAAA,KAAAA,IAAAA,IAAAA,mBAAA,uBAAAA,mBAAA,CAAqBtD,OAAQU,EAAAA,CAAK,EAAA,EAAA;AAChD,QAAA,IAAA4C,mBAAA,CAAoB5C,MAAMoE,gBAAkB,EAAA;AAC/B9D,UAAAA,YAAA,GAAAN,CAAA,CAAA;AACf,UAAA,MAAA;AACF,SAAA;AACF,OAAA;AAEA,MAAA,IAAMa,aAAarB,IAAK,CAAAsB,GAAA,CAAIR,YAAe,GAAA5B,OAAA,CAAQI,YAAY,CAAC,CAAA,CAAA;AAChE,MAAA,IAAMiC,WAAWvB,IAAK,CAAAC,GAAA,CAAIoB,UAAa,GAAAtB,YAAA,EAAcrC,KAAKoC,MAAM,CAAA,CAAA;MAChE,IAAMgF,OAAU,GAAApH,IAAA,CAAKsE,KAAM,CAAAX,UAAA,EAAYE,QAAQ,CAAA,CAAA;AAE3ChD,MAAAA,IAAAA,WAAAA,GAAa8C,aAAanC,OAAQ,CAAAM,SAAA,CAAA;AAEtC,MAAA,IAAI,CAAA4D,mBAAqB,KAArBA,IAAAA,IAAAA,mBAAqB,uBAArBA,mBAAqB,CAAAtD,MAAA,IAAS,CAAK,IAAAuB,UAAA,GAAa,CAAG,EAAA;QAC/C,IAAA0D,UAAA,GAAa3B,oBAAoBpD,IAAK,CAAAC,GAAA,CAAIoB,aAAa,CAAG,EAAA+B,mBAAA,CAAoBtD,MAAS,GAAA,CAAC,CAAM,CAAA,IAAA,CAAA,CAAA;QACpGvB,WAAa,GAAAyB,IAAA,CAAKsB,GAAI,CAAA,CAAA,EAAGyD,UAAU,CAAA,CAAA;AACrC,OAAA;MAEA3G,cAAA,CAAe0G,OAAO,CAAA,CAAA;MACtBtG,aAAA,CAAcD,WAAU,CAAA,CAAA;AAC1B,KAAA;AAEM,IAAA,IAAA+F,KAAA,GAAQlH,WAAW,YAAM;MAC7B,IAAIE,UAAU2D,OAAS,EAAA;QACrB,IAAM+D,kBAAqB,GAAA1H,SAAA,CAAU2D,OAAQ,CAAAC,qBAAA,EAAwB,CAAAC,MAAA,CAAA;QACrErD,eAAA,CAAgBmD,OAAU,GAAA+D,kBAAA,CAAA;AACpB5B,QAAAA,IAAAA,oBAAAA,GAAsB9C,yBAAyBtB,YAAY,CAAA,CAAA;QACjEH,qBAAA,CAAsBoC,OAAUmC,GAAAA,oBAAAA,CAAAA;QAChCmB,YAAA,CAAaD,KAAK,CAAA,CAAA;AACpB,OAAA;OACC,CAAC,CAAA,CAAA;AACN,GAAA,EAEA,CAAChH,SAAW,EAAAI,IAAA,EAAMwB,OAAS,EAAAW,eAAA,EAAiBO,kBAAkBpB,YAAY,CAC5E,CAAA,CAAA;EAEO,OAAA;AACLb,IAAAA,WAAA,EAAAA,WAAA;AACAI,IAAAA,UAAA,EAAAA,UAAA;AACAI,IAAAA,YAAA,EAAAA,YAAA;AACAkB,IAAAA,eAAA,EAAAA,eAAA;AACAwD,IAAAA,YAAA,EAAAA,YAAA;AACAT,IAAAA,gBAAA,EAAAA,gBAAA;AACAqB,IAAAA,eAAA,EAAAA,eAAAA;GACF,CAAA;AACF;;;;"}