{"version":3,"file":"useMouseEvent.js","sources":["../../../components/hooks/useMouseEvent.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\nexport type MouseEventLike = MouseEvent | React.MouseEvent | TouchEvent | React.TouchEvent;\nexport type MouseCallback = MouseEvent | React.MouseEvent | Touch | React.Touch;\n\n/**\n * 鼠标相对当前元素的坐标\n */\nexport interface MouseCoordinate {\n  x: number;\n  y: number;\n}\nexport interface MouseContext {\n  coordinate: MouseCoordinate;\n}\n\ntype MouseEventOptions = {\n  enabled?: boolean;\n  enableTouch?: boolean; // 支持触摸事件\n  onDown?: (e: MouseCallback, ctx: MouseContext) => void;\n  onMove?: (e: MouseCallback, ctx: MouseContext) => void;\n  onUp?: (e: MouseCallback, ctx: MouseContext) => void;\n  onEnter?: (e: MouseCallback, ctx: MouseContext) => void;\n  onLeave?: (e: MouseCallback, ctx: MouseContext) => void;\n};\n\nconst useMouseEvent = (elementRef: React.RefObject<HTMLElement>, options: MouseEventOptions) => {\n  const { enabled = true, enableTouch = true } = options;\n  const isMovingRef = useRef(false);\n\n  const normalizeEvent = (e: MouseEventLike) => {\n    if (!enableTouch) {\n      return e as MouseEvent;\n    }\n    if ('touches' in e && e.touches.length > 0) {\n      return e.touches[0];\n    }\n    if ('changedTouches' in e && e.changedTouches.length > 0) {\n      return e.changedTouches[0];\n    }\n    if ('clientX' in e && 'clientY' in e) {\n      return e as MouseEvent;\n    }\n    return undefined;\n  };\n\n  const getCoordinate = (event: MouseCallback) => {\n    const rect = elementRef.current?.getBoundingClientRect();\n    if (!rect) {\n      return { x: 0, y: 0 };\n    }\n    const { clientX, clientY } = event;\n    const left = clientX - rect.left;\n    const top = clientY - rect.top;\n    return {\n      x: Math.min(Math.max(0, left), rect.width),\n      y: Math.min(Math.max(0, top), rect.height),\n    };\n  };\n\n  const emitMouseChange = (e: MouseEventLike, handler?: (e: MouseCallback, ctx: MouseContext) => void) => {\n    if (!handler) return;\n    const event = normalizeEvent(e);\n    const coordinate = getCoordinate(event);\n    handler(event, { coordinate });\n  };\n\n  const handleMouseMove = (e: MouseEventLike) => {\n    if (!isMovingRef.current) return;\n    e.preventDefault();\n    emitMouseChange(e, options.onMove);\n  };\n\n  const handleMouseUp = (e: MouseEventLike) => {\n    if (!isMovingRef.current) return;\n    isMovingRef.current = false;\n    emitMouseChange(e, options.onUp);\n    document.removeEventListener('mouseup', handleMouseUp);\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('touchend', handleMouseUp);\n    document.removeEventListener('touchmove', handleMouseMove);\n  };\n\n  const handleMouseDown = (e: MouseEventLike) => {\n    // 只处理鼠标左键，忽略中和右键\n    // 触摸事件没有 button 属性，会正常处理\n    if ('button' in e && e.button !== 0) return;\n\n    isMovingRef.current = true;\n    emitMouseChange(e, options.onDown);\n    document.addEventListener('mouseup', handleMouseUp);\n    document.addEventListener('mousemove', handleMouseMove);\n    if (!enableTouch) return;\n    document.addEventListener('touchend', handleMouseUp);\n    document.addEventListener('touchmove', handleMouseMove, { passive: false });\n  };\n\n  const handleMouseEnter = (e: MouseEventLike) => {\n    emitMouseChange(e, options.onEnter);\n  };\n\n  const handleMouseLeave = (e: MouseEventLike) => {\n    emitMouseChange(e, options.onLeave);\n  };\n\n  useEffect(() => {\n    const el = elementRef.current;\n    if (!el || !enabled) return;\n\n    // 基本上只要开启了鼠标事件，就会用到这三个\n    // 有的组件虽然只需要 mousemove 的回调结果，但也需要 mousedown 和 mouseup 来控制状态\n    el.addEventListener('mousedown', handleMouseDown);\n    el.addEventListener('mousemove', handleMouseMove);\n    el.addEventListener('mouseup', handleMouseUp);\n    // 下面这两个一般是为了处理 hover 状态，可选性监听\n    options.onEnter && el.addEventListener('mouseenter', handleMouseEnter);\n    options.onLeave && el.addEventListener('mouseleave', handleMouseLeave);\n\n    if (!enableTouch) return;\n    el.addEventListener('touchstart', handleMouseDown, { passive: false });\n    el.addEventListener('touchend', handleMouseUp);\n\n    return () => {\n      el.removeEventListener('mousedown', handleMouseDown);\n      el.removeEventListener('mouseenter', handleMouseDown);\n      el.removeEventListener('mouseleave', handleMouseLeave);\n      el.removeEventListener('mousemove', handleMouseMove);\n      el.removeEventListener('mouseup', handleMouseUp);\n      el.removeEventListener('touchstart', handleMouseDown);\n      el.removeEventListener('touchend', handleMouseUp);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [elementRef.current, options, enabled]);\n\n  return {\n    isMoving: isMovingRef.current,\n  };\n};\n\nexport default useMouseEvent;\n"],"names":["useMouseEvent","elementRef","options","_options$enabled","enabled","_options$enableTouch","enableTouch","isMovingRef","useRef","normalizeEvent","e","touches","length","changedTouches","getCoordinate","event","_elementRef$current","rect","current","getBoundingClientRect","x","y","clientX","clientY","left","top","Math","min","max","width","height","emitMouseChange","handler","coordinate","handleMouseMove","preventDefault","onMove","handleMouseUp","onUp","document","removeEventListener","handleMouseDown","button","onDown","addEventListener","passive","handleMouseEnter","onEnter","handleMouseLeave","onLeave","useEffect","el","isMoving"],"mappings":"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"}