{"version":3,"file":"useTreeData.js","sources":["../../../../components/table/hooks/useTreeData.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport classNames from 'classnames';\nimport { get, isEqual } from 'lodash-es';\nimport TableTreeStore, { type SwapParams } from '@tdesign/common-js/table/tree-store';\nimport {\n  AddRectangleIcon as TdAddRectangleIcon,\n  MinusRectangleIcon as TdMinusRectangleIcon,\n} from 'tdesign-icons-react';\nimport { parseContentTNode } from '../../_util/parseTNode';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { renderCell } from '../Cell';\nimport useClassName from './useClassName';\nimport useTreeDataExpand from './useTreeDataExpand';\n\nimport type { PrimaryTableCol, TableRowData, TableRowState, TableRowValue, TdEnhancedTableProps } from '../type';\n\nexport interface UseSwapParams<T> extends SwapParams<T> {\n  data: T[];\n}\n\nexport default function useTreeData(props: TdEnhancedTableProps) {\n  const { data, columns, tree, rowKey, treeExpandAndFoldIcon, expandedTreeNodes } = props;\n  const { tableTreeClasses } = useClassName();\n  const [locale, t] = useLocaleReceiver('table');\n  const { AddRectangleIcon, MinusRectangleIcon } = useGlobalIcon({\n    AddRectangleIcon: TdAddRectangleIcon,\n    MinusRectangleIcon: TdMinusRectangleIcon,\n  });\n\n  const dataRef = useRef(data);\n  const isManuallyModified = useRef(false); // （节点）数据结构被更新，不包括展开状态\n\n  const [store] = useState(() => new TableTreeStore() as InstanceType<typeof TableTreeStore>);\n  const [treeNodeCol, setTreeNodeCol] = useState<PrimaryTableCol>(() => getTreeNodeColumnCol());\n  const [dataSource, setDataSource] = useState<TdEnhancedTableProps['data']>(data || []);\n\n  const updateDataSourceManually = (newDataSource: TdEnhancedTableProps['data']) => {\n    setDataSource([...newDataSource]);\n    isManuallyModified.current = true;\n  };\n\n  const rowDataKeys = useMemo(\n    () => ({\n      rowKey: rowKey || 'id',\n      childrenKey: tree?.childrenKey || 'children',\n    }),\n    [rowKey, tree?.childrenKey],\n  );\n\n  const { expandAll, foldAll, updateExpandOnDataChange, onExpandFoldIconClick } = useTreeDataExpand(props, {\n    store,\n    dataSource,\n    rowDataKeys,\n    setDataSource,\n  });\n\n  const checkedColumn = useMemo(() => columns.find((col) => col.colKey === 'row-select'), [columns]);\n\n  useEffect(() => {\n    if (!store || !checkedColumn) return;\n    // 第一次，不需要执行 updateDisabledState\n    const rowValue = get(dataSource[0], rowDataKeys.rowKey);\n    if (!store.treeDataMap.get(rowValue)) return;\n    store.updateDisabledState(dataSource, checkedColumn, rowDataKeys);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [checkedColumn]);\n\n  useEffect(() => {\n    if (!data || !store) return;\n    dataRef.current = data;\n\n    // 如果没有树形解构，则不需要相关逻辑\n    if (!tree) {\n      setDataSource(data);\n      return;\n    }\n\n    const dataChanged = !isEqual(dataRef.current, data);\n\n    if (dataChanged || !isManuallyModified.current) {\n      resetData(data);\n      if (dataChanged) {\n        isManuallyModified.current = false;\n      }\n    } else {\n      updateExpandOnDataChange([...dataSource]);\n      isManuallyModified.current = false;\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [data, expandedTreeNodes]);\n\n  useEffect(\n    () => {\n      const treeNodeColTmp = getTreeNodeColumnCol();\n      setTreeNodeCol(treeNodeColTmp);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [columns, props.tree?.treeNodeColumnIndex],\n  );\n\n  function resetData(data: TableRowData[]) {\n    const { columns } = props;\n    store.initialTreeStore(data, columns, rowDataKeys);\n    updateExpandOnDataChange([...data]);\n  }\n\n  function getTreeNodeStyle(level: number) {\n    if (level === undefined) return;\n    const indent = props.tree?.indent === undefined ? 24 : props.tree?.indent;\n    // 默认 1px 是为了临界省略\n    return indent ? { paddingLeft: `${level * indent || 1}px` } : {};\n  }\n\n  /**\n   * 对外暴露的组件实例方法，展开或收起某一行\n   * @param p 行数据\n   */\n  function toggleExpandData(p: { row: TableRowData; rowIndex: number }, trigger?: 'expand-fold-icon' | 'row-click') {\n    const currentData = { ...p };\n    // eslint-disable-next-line\n    if (p.row.__VIRTUAL_SCROLL_INDEX !== undefined) {\n      // eslint-disable-next-line\n      currentData.rowIndex = p.row.__VIRTUAL_SCROLL_INDEX;\n    }\n    const newData = store.toggleExpandData(currentData, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n    const rowValue = get(p.row, rowDataKeys.rowKey);\n    props.onTreeExpandChange?.({\n      row: p.row,\n      rowIndex: p.rowIndex,\n      rowState: store?.treeDataMap?.get(rowValue),\n      trigger,\n    });\n  }\n\n  function getTreeNodeColumnCol() {\n    const { columns } = props;\n    let treeNodeColumnIndex = props.tree?.treeNodeColumnIndex || 0;\n    // type 存在，则表示表格内部渲染的特殊列，比如：展开行按钮、复选框、单选按钮等，不能作为树结点列。因此树结点展开列向后顺移\n    while (\n      columns[treeNodeColumnIndex]?.type ||\n      columns[treeNodeColumnIndex]?.colKey === '__EXPAND_ROW_ICON_COLUMN__'\n    ) {\n      treeNodeColumnIndex += 1;\n    }\n    return columns[treeNodeColumnIndex];\n  }\n\n  function formatTreeColumn(col: PrimaryTableCol): PrimaryTableCol {\n    if (!col || !treeNodeCol || !store) return {};\n    if (!props.tree || !Object.keys(props.tree).length || col.colKey !== treeNodeCol.colKey) return col;\n    const newCol = { ...treeNodeCol };\n    newCol.cell = (p) => {\n      const cellInfo = renderCell(\n        { ...p, col: { ...treeNodeCol } },\n        {\n          cellEmptyContent: props.cellEmptyContent,\n        },\n      );\n      const currentState = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey));\n      const colStyle = getTreeNodeStyle(currentState?.level);\n      const classes = { [tableTreeClasses.inlineCol]: !!col.ellipsis };\n      const childrenNodes = get(p.row, rowDataKeys.childrenKey);\n      if ((Array.isArray(childrenNodes) && childrenNodes.length > 0) || childrenNodes === true) {\n        const expanded = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey))?.expanded;\n        const type = expanded ? 'fold' : 'expand';\n        const defaultIconNode =\n          t(locale.treeExpandAndFoldIcon, { type }) || (expanded ? <MinusRectangleIcon /> : <AddRectangleIcon />);\n        const iconNode = treeExpandAndFoldIcon\n          ? parseContentTNode(treeExpandAndFoldIcon, { type, ...p })\n          : defaultIconNode;\n        return (\n          <div className={classNames([tableTreeClasses.col, classes])} style={colStyle}>\n            {!!(childrenNodes.length || childrenNodes === true) && (\n              <span\n                className={tableTreeClasses.icon}\n                onClick={(e: React.MouseEvent<HTMLSpanElement>) => {\n                  onExpandFoldIconClick(p, 'expand-fold-icon');\n                  e.stopPropagation();\n                }}\n              >\n                {iconNode}\n              </span>\n            )}\n            {cellInfo}\n          </div>\n        );\n      }\n      return (\n        <div style={colStyle} className={classNames([classes, tableTreeClasses.leafNode])}>\n          <span className={tableTreeClasses.icon}></span>\n          {cellInfo}\n        </div>\n      );\n    };\n    // 树形节点会显示操作符号 [+] 和 [-]，但省略显示的浮层中不需要操作符\n    if (newCol.ellipsis === true) {\n      newCol.ellipsis = (p) => renderCell({ ...p, col: { ...treeNodeCol } });\n    }\n    return newCol;\n  }\n\n  /**\n   * 对外暴露的组件实例方法，设置行数据，自动刷新界面\n   * @param key 当前行唯一标识值\n   * @param newRowData 新行数据\n   */\n  function setData<T>(key: TableRowValue, newRowData: T) {\n    const rowIndex = store.updateData(key, newRowData, dataSource, rowDataKeys);\n    const newData = [...dataSource];\n    newData[rowIndex] = newRowData;\n    updateDataSourceManually(newData);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取当前行全部数据\n   * @param key 行唯一标识\n   * @returns {TableRowState} 当前行数据\n   */\n  function getData(key: TableRowValue): TableRowState {\n    return store.getData(key);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，对外暴露的组件实例方法，移除指定节点\n   * @param key 行唯一标识\n   */\n  function remove(key: TableRowValue) {\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    const newData = store.remove(key, dataSource, rowDataKeys);\n    updateDataSourceManually(newData);\n  }\n\n  /**\n   * 移除子节点\n   * @param key 行唯一标识\n   */\n  function removeChildren(key: TableRowValue) {\n    const newData = store.removeChildren(key, dataSource, rowDataKeys);\n    updateDataSourceManually(newData);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，为当前节点添加子节点，默认添加到最后一个节点\n   * @param key 当前节点唯一标识\n   * @param newData 待添加的新节点\n   */\n  function appendTo<T>(key: TableRowValue, newData: T | T[]) {\n    if (!key) {\n      updateDataSourceManually([...store.appendToRoot(newData, dataSource, rowDataKeys)]);\n      return;\n    }\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    updateDataSourceManually([...store.appendTo(key, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertAfter<T>(rowValue: TableRowValue, newData: T) {\n    updateDataSourceManually([...store.insertAfter(rowValue, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertBefore<T>(rowValue: TableRowValue, newData: T) {\n    updateDataSourceManually(store.insertBefore(rowValue, newData, dataSource, rowDataKeys));\n  }\n\n  /**\n   * 对外暴露的组件实例方法，交换行数据，React 在回掉函数函数中无法获取最新的 state 信息，因此需要参数 params.data\n   */\n  function swapData(params: UseSwapParams<TableRowData>) {\n    const r = store.swapData(params.data, params, rowDataKeys);\n    if (r.result) {\n      updateDataSourceManually(r.dataSource);\n    } else {\n      const params = {\n        code: r.code,\n        reason: r.reason,\n      };\n      props.onAbnormalDragSort?.(params);\n    }\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取全部数据的树形结构\n   * @param key 节点唯一标识\n   */\n  function getTreeNode() {\n    return store.getTreeNode(dataSource, rowDataKeys);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取树形结构展开的节点\n   */\n  function getTreeExpandedRow(type: 'unique' | 'data' | 'all' = 'data') {\n    return store.getTreeExpandedRow(dataSource, rowDataKeys, type);\n  }\n\n  return {\n    store,\n    rowDataKeys,\n    dataSource,\n    swapData,\n    setData,\n    getData,\n    remove,\n    removeChildren,\n    appendTo,\n    insertAfter,\n    insertBefore,\n    formatTreeColumn,\n    toggleExpandData,\n    expandAll,\n    foldAll,\n    getTreeNode,\n    resetData,\n    getTreeExpandedRow,\n    onExpandFoldIconClick,\n  };\n}\n\nexport type UseTreeDataReturnType = ReturnType<typeof useTreeData>;\n"],"names":["useTreeData","props","_props$tree","data","columns","tree","rowKey","treeExpandAndFoldIcon","expandedTreeNodes","_useClassName","useClassName","tableTreeClasses","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","locale","t","_useGlobalIcon","useGlobalIcon","AddRectangleIcon","TdAddRectangleIcon","MinusRectangleIcon","TdMinusRectangleIcon","dataRef","useRef","isManuallyModified","_useState","useState","TableTreeStore","_useState2","store","_useState3","getTreeNodeColumnCol","_useState4","treeNodeCol","setTreeNodeCol","_useState5","_useState6","dataSource","setDataSource","updateDataSourceManually","newDataSource","_toConsumableArray","current","rowDataKeys","useMemo","childrenKey","_useTreeDataExpand","useTreeDataExpand","expandAll","foldAll","updateExpandOnDataChange","onExpandFoldIconClick","checkedColumn","find","col","colKey","useEffect","rowValue","get","treeDataMap","updateDisabledState","dataChanged","isEqual","resetData","treeNodeColTmp","treeNodeColumnIndex","initialTreeStore","getTreeNodeStyle","level","_props$tree2","_props$tree3","indent","paddingLeft","concat","toggleExpandData","p","trigger","_props$onTreeExpandCh","_store$treeDataMap","currentData","_objectSpread","row","__VIRTUAL_SCROLL_INDEX","rowIndex","newData","onTreeExpandChange","call","rowState","_props$tree4","_columns2$treeNodeCol","type","_columns2$treeNodeCol2","formatTreeColumn","Object","keys","length","newCol","cell","cellInfo","renderCell","cellEmptyContent","currentState","colStyle","classes","_defineProperty","inlineCol","ellipsis","childrenNodes","Array","isArray","_store$treeDataMap$ge","expanded","defaultIconNode","React","createElement","iconNode","parseContentTNode","className","classNames","style","icon","onClick","e","stopPropagation","leafNode","setData","key","newRowData","updateData","getData","remove","removeChildren","appendTo","appendToRoot","insertAfter","insertBefore","swapData","params","r","result","_props$onAbnormalDrag","code","reason","onAbnormalDragSort","getTreeNode","getTreeExpandedRow"],"mappings":"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"}