{"version":3,"file":"useMutationObserver.js","sources":["../../../components/hooks/useMutationObserver.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { debounce, isEqual } from 'lodash-es';\nimport useLatest from './useLatest';\n\nconst DEFAULT_OPTIONS = {\n  debounceTime: 0,\n  config: {\n    attributes: true,\n    childList: true,\n    characterData: true,\n    subtree: true,\n  } as MutationObserverInit,\n};\n\ntype Options = typeof DEFAULT_OPTIONS;\n\nexport default function useMutationObservable(\n  targetEl: HTMLElement | null,\n  cb: MutationCallback,\n  options?: Partial<Options>,\n) {\n  const optionsRef = useRef<Options>(null);\n  const signalRef = useRef(0);\n  const callbackRef = useLatest(cb);\n\n  // 合并用户配置和默认配置\n  const mergedOptions: Options = {\n    debounceTime: options?.debounceTime ?? DEFAULT_OPTIONS.debounceTime,\n    config: {\n      ...DEFAULT_OPTIONS.config,\n      ...options?.config,\n    },\n  };\n\n  if (!isEqual(mergedOptions, optionsRef.current)) {\n    signalRef.current += 1;\n  }\n\n  optionsRef.current = mergedOptions;\n\n  useEffect(() => {\n    if (!targetEl || !targetEl?.nodeType) return;\n    let observer: MutationObserver = null;\n    try {\n      const { debounceTime, config } = optionsRef.current;\n      const mutationCallback: MutationCallback = (...args) => {\n        callbackRef.current(...args);\n      };\n      observer = new MutationObserver(debounceTime > 0 ? debounce(mutationCallback, debounceTime) : mutationCallback);\n      observer.observe(targetEl, config);\n    } catch (e) {\n      console.error(e);\n    }\n\n    return () => {\n      if (observer) {\n        observer.disconnect();\n        observer = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetEl, signalRef.current]);\n}\n"],"names":["DEFAULT_OPTIONS","debounceTime","config","attributes","childList","characterData","subtree","useMutationObservable","targetEl","cb","options","_options$debounceTime","optionsRef","useRef","signalRef","callbackRef","useLatest","mergedOptions","_objectSpread","isEqual","current","useEffect","nodeType","observer","_optionsRef$current","mutationCallback","apply","arguments","MutationObserver","debounce","observe","e","console","error","disconnect"],"mappings":";;;;;;;;;;;;;;AAIA,IAAMA,eAAkB,GAAA;AACtBC,EAAAA,YAAc,EAAA,CAAA;AACdC,EAAAA,MAAQ,EAAA;AACNC,IAAAA,UAAY,EAAA,IAAA;AACZC,IAAAA,SAAW,EAAA,IAAA;AACXC,IAAAA,aAAe,EAAA,IAAA;AACfC,IAAAA,OAAS,EAAA,IAAA;AACX,GAAA;AACF,CAAA,CAAA;AAIwB,SAAAC,qBAAAA,CACtBC,QACA,EAAAC,EAAA,EACAC,OACA,EAAA;AAAA,EAAA,IAAAC,qBAAA,CAAA;AACM,EAAA,IAAAC,UAAA,GAAaC,OAAgB,IAAI,CAAA,CAAA;AACjC,EAAA,IAAAC,SAAA,GAAYD,OAAO,CAAC,CAAA,CAAA;AACpB,EAAA,IAAAE,WAAA,GAAcC,UAAUP,EAAE,CAAA,CAAA;AAGhC,EAAA,IAAMQ,aAAyB,GAAA;AAC7BhB,IAAAA,YAAA,GAAAU,qBAAA,GAAcD,OAAS,KAAA,IAAA,IAATA,OAAS,KAATA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAS,CAAAT,YAAA,cAAAU,qBAAA,KAAA,KAAA,CAAA,GAAAA,qBAAA,GAAgBX,eAAgB,CAAAC,YAAA;AACvDC,IAAAA,MAAQ,EAAAgB,aAAA,CAAAA,aAAA,KACHlB,eAAgB,CAAAE,MAAA,CAAA,EAChBQ,OAAS,KAATA,IAAAA,IAAAA,OAAS,KAATA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAS,CAAAR,MAAA,CAAA;GAEhB,CAAA;EAEA,IAAI,CAACiB,OAAA,CAAQF,aAAe,EAAAL,UAAA,CAAWQ,OAAO,CAAG,EAAA;IAC/CN,SAAA,CAAUM,OAAW,IAAA,CAAA,CAAA;AACvB,GAAA;EAEAR,UAAA,CAAWQ,OAAU,GAAAH,aAAA,CAAA;AAErBI,EAAAA,SAAA,CAAU,YAAM;IACV,IAAA,CAACb,QAAY,IAAA,EAACA,QAAU,KAAVA,IAAAA,IAAAA,QAAU,KAAVA,KAAAA,CAAAA,IAAAA,QAAU,CAAAc,QAAA,CAAU,EAAA,OAAA;IACtC,IAAIC,QAA6B,GAAA,IAAA,CAAA;IAC7B,IAAA;AACF,MAAA,IAAAC,mBAAA,GAAiCZ,UAAW,CAAAQ,OAAA;QAApCnB,YAAA,GAAAuB,mBAAA,CAAAvB,YAAA;QAAcC,MAAO,GAAAsB,mBAAA,CAAPtB,MAAO,CAAA;AACvB,MAAA,IAAAuB,gBAAA,GAAqC,SAArCA,gBAAAA,GAAkD;QAC1CV,WAAA,CAAAK,OAAA,CAAAM,KAAA,CAAAX,WAAA,EAAAY,SAAe,CAAA,CAAA;OAC7B,CAAA;AACWJ,MAAAA,QAAA,GAAA,IAAIK,iBAAiB3B,YAAe,GAAA,CAAA,GAAI4B,SAASJ,gBAAkB,EAAAxB,YAAY,IAAIwB,gBAAgB,CAAA,CAAA;AACrGF,MAAAA,QAAA,CAAAO,OAAA,CAAQtB,UAAUN,MAAM,CAAA,CAAA;aAC1B6B,CAAP,EAAA;AACAC,MAAAA,OAAA,CAAQC,MAAMF,CAAC,CAAA,CAAA;AACjB,KAAA;AAEA,IAAA,OAAO,YAAM;AACX,MAAA,IAAIR,QAAU,EAAA;QACZA,QAAA,CAASW,UAAW,EAAA,CAAA;AACTX,QAAAA,QAAA,GAAA,IAAA,CAAA;AACb,OAAA;KACF,CAAA;GAEC,EAAA,CAACf,QAAU,EAAAM,SAAA,CAAUM,OAAO,CAAC,CAAA,CAAA;AAClC;;;;"}