{"version":3,"file":"useLockStyle.js","sources":["../../../../components/dialog/hooks/useLockStyle.ts"],"sourcesContent":["import { useRef, useCallback } from 'react';\nimport { getScrollbarWidth } from '@tdesign/common-js/utils/getScrollbarWidth';\nimport useLayoutEffect from '../../hooks/useLayoutEffect';\n\nlet key = 1;\n\nexport default function useDialogLockStyle({ preventScrollThrough, visible, mode, showInAttachedElement }) {\n  const lockStyleRef = useRef<HTMLStyleElement>(null);\n  const timerRef = useRef(null);\n\n  const clearStyleFunc = useCallback(() => {\n    clearTimeout(timerRef.current);\n    timerRef.current = setTimeout(() => {\n      lockStyleRef.current?.parentNode?.removeChild?.(lockStyleRef.current);\n    }, 150);\n  }, []);\n\n  useLayoutEffect(() => {\n    if (typeof document === 'undefined' || !visible) return;\n    if (!lockStyleRef.current) {\n      lockStyleRef.current = document.createElement('style');\n    }\n    const hasScrollBar = document.documentElement.scrollHeight > document.documentElement.clientHeight;\n    const scrollbarWidth = hasScrollBar ? getScrollbarWidth() : 0;\n\n    lockStyleRef.current.dataset.id = `td_dialog_${+new Date()}_${(key += 1)}`;\n    lockStyleRef.current.innerHTML = `\n      html body {\n        overflow-y: hidden;\n        width: calc(100% - ${scrollbarWidth}px);\n      }\n    `;\n\n    return clearStyleFunc;\n  }, [visible, clearStyleFunc]);\n\n  useLayoutEffect(() => {\n    if (typeof document === 'undefined') return;\n    if (mode !== 'modal' || !preventScrollThrough || showInAttachedElement) return;\n\n    if (visible) {\n      document.head.appendChild(lockStyleRef.current);\n    } else {\n      clearStyleFunc();\n    }\n  }, [preventScrollThrough, visible, mode, showInAttachedElement, clearStyleFunc]);\n}\n"],"names":["key","useDialogLockStyle","preventScrollThrough","_ref","visible","mode","showInAttachedElement","lockStyleRef","useRef","timerRef","clearStyleFunc","useCallback","clearTimeout","current","setTimeout","_lockStyleRef$current","_lockStyleRef$current2","parentNode","removeChild","call","useLayoutEffect","document","createElement","hasScrollBar","documentElement","scrollHeight","clientHeight","scrollbarWidth","getScrollbarWidth","dataset","id","concat","Date","innerHTML","head","appendChild"],"mappings":";;;;;;;;;;;;;;;;;;;AAIA,IAAIA,GAAM,GAAA,CAAA,CAAA;AAEV,SAAwBC,yBAAmF;AAAA,EAAA,IAA9DC,oBAAA,GAAAC,IAAA,CAAAD,oBAAA;IAAsBE,OAAS,GAAAD,IAAA,CAATC,OAAS;IAAAC,IAAA,GAAAF,IAAA,CAAAE,IAAA;IAAMC,6BAAAA;AAC1E,EAAA,IAAAC,YAAA,GAAeC,OAAyB,IAAI,CAAA,CAAA;AAC5C,EAAA,IAAAC,QAAA,GAAWD,OAAO,IAAI,CAAA,CAAA;AAEtB,EAAA,IAAAE,cAAA,GAAiBC,YAAY,YAAM;AACvCC,IAAAA,YAAA,CAAaH,SAASI,OAAO,CAAA,CAAA;AACpBJ,IAAAA,QAAA,CAAAI,OAAA,GAAUC,WAAW,YAAM;MAAA,IAAAC,qBAAA,EAAAC,sBAAA,CAAA;AAClC,MAAA,CAAAD,qBAAA,GAAAR,YAAA,CAAaM,OAAS,MAAAE,IAAAA,IAAAA,qBAAA,KAAAA,KAAAA,CAAAA,IAAAA,CAAAA,qBAAA,GAAtBA,qBAAA,CAAsBE,UAAA,cAAAF,qBAAA,KAAA,KAAA,CAAA,IAAA,CAAAC,sBAAA,GAAtBD,qBAAA,CAAkCG,WAAc,MAAA,IAAA,IAAAF,sBAAA,KAAhDA,KAAAA,CAAAA,IAAAA,sBAAA,CAAAG,IAAA,CAAAJ,qBAAA,EAAgDR,YAAA,CAAaM,OAAO,CAAA,CAAA;OACnE,GAAG,CAAA,CAAA;GACR,EAAG,EAAE,CAAA,CAAA;AAELO,EAAAA,yBAAA,CAAgB,YAAM;AAChB,IAAA,IAAA,OAAOC,QAAa,KAAA,WAAA,IAAe,CAACjB,OAAA,EAAS,OAAA;AAC7C,IAAA,IAAA,CAACG,aAAaM,OAAS,EAAA;MACZN,YAAA,CAAAM,OAAA,GAAUQ,QAAS,CAAAC,aAAA,CAAc,OAAO,CAAA,CAAA;AACvD,KAAA;AACA,IAAA,IAAMC,YAAe,GAAAF,QAAA,CAASG,eAAgB,CAAAC,YAAA,GAAeJ,SAASG,eAAgB,CAAAE,YAAA,CAAA;IAChF,IAAAC,cAAA,GAAiBJ,YAAe,GAAAK,iBAAA,EAAsB,GAAA,CAAA,CAAA;IAE/CrB,YAAA,CAAAM,OAAA,CAAQgB,QAAQC,EAAK,GAAA,YAAA,CAAAC,MAAA,CAAa,CAAC,IAAIC,IAAA,gBAAWhC,GAAO,IAAA,CAAA,CAAA,CAAA;IACtEO,YAAA,CAAaM,QAAQoB,SAAY,mFAAAF,MAAA,CAGRJ,cAAA,EAAA,qBAAA,CAAA,CAAA;AAIlB,IAAA,OAAAjB,cAAA,CAAA;AACT,GAAG,EAAA,CAACN,OAAS,EAAAM,cAAc,CAAC,CAAA,CAAA;AAE5BU,EAAAA,yBAAA,CAAgB,YAAM;AACpB,IAAA,IAAI,OAAOC,QAAa,KAAA,WAAA,EAAa,OAAA;IACjC,IAAAhB,IAAA,KAAS,OAAW,IAAA,CAACH,oBAAwB,IAAAI,qBAAA,EAAuB,OAAA;AAExE,IAAA,IAAIF,OAAS,EAAA;MACFiB,QAAA,CAAAa,IAAA,CAAKC,WAAY,CAAA5B,YAAA,CAAaM,OAAO,CAAA,CAAA;AAChD,KAAO,MAAA;AACUH,MAAAA,cAAA,EAAA,CAAA;AACjB,KAAA;AACF,KAAG,CAACR,oBAAA,EAAsBE,SAASC,IAAM,EAAAC,qBAAA,EAAuBI,cAAc,CAAC,CAAA,CAAA;AACjF;;;;"}