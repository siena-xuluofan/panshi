{"version":3,"file":"usePagination.js","sources":["../../../../components/table/hooks/usePagination.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport useConfig from '../../hooks/useConfig';\nimport Pagination, { PageInfo, PaginationProps } from '../../pagination';\nimport type { TableRowData, TdBaseTableProps } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps, tableContentRef: React.RefObject<HTMLDivElement>) {\n  const { pagination, data, disableDataPage } = props;\n  const { classPrefix } = useConfig();\n  const [innerPagination, setInnerPagination] = useState<PaginationProps>(props.pagination);\n\n  const [dataSource, setDataSource] = useState<TableRowData[]>([]);\n  const [isPaginateData, setIsPaginateData] = useState(false);\n\n  const isControlled = pagination?.current !== undefined;\n\n  const calculatePaginatedData = useCallback(\n    (current = 1, pageSize = 10) => {\n      // data 数据数量超出分页大小时，则自动启动本地数据分页\n      const shouldPaginate = Boolean(!disableDataPage && data.length > pageSize);\n      let newData: TableRowData[] = [];\n      if (shouldPaginate) {\n        const start = (current - 1) * pageSize;\n        const end = current * pageSize;\n        newData = [...data.slice(start, end)];\n      } else {\n        newData = data;\n      }\n      return { newData, shouldPaginate };\n    },\n    [data, disableDataPage],\n  );\n\n  const updateDataSourceAndPaginate = useCallback(\n    (current = 1, pageSize = 10) => {\n      const { newData, shouldPaginate } = calculatePaginatedData(current, pageSize);\n      setIsPaginateData(shouldPaginate);\n      setDataSource(newData);\n      return newData;\n    },\n    [calculatePaginatedData],\n  );\n\n  useEffect(() => {\n    if (!pagination) {\n      setIsPaginateData(false);\n    }\n  }, [pagination]);\n\n  // 受控情况\n  useEffect(() => {\n    if (!pagination || !isControlled) return;\n    const [current, pageSize] = [pagination?.current || 1, pagination?.pageSize ?? 10];\n    updateDataSourceAndPaginate(current, pageSize);\n    setInnerPagination({ current, pageSize });\n  }, [pagination, isControlled, updateDataSourceAndPaginate]);\n\n  // 非受控情况\n  useEffect(() => {\n    if (!pagination || isControlled) return;\n    const [current, pageSize] = [pagination?.defaultCurrent || 1, pagination?.defaultPageSize ?? 10];\n    updateDataSourceAndPaginate(current, pageSize);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isControlled, updateDataSourceAndPaginate]);\n\n  const renderPagination = () => {\n    if (!pagination) return null;\n    return (\n      <div className={`${classPrefix}-table__pagination`}>\n        <Pagination\n          {...pagination}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            if (isControlled) {\n              const { newData } = calculatePaginatedData(pageInfo.current, pageInfo.pageSize);\n              props.onPageChange?.(pageInfo, newData);\n            } else {\n              setInnerPagination(pageInfo);\n              const newData = updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n              props.onPageChange?.(pageInfo, newData);\n            }\n\n            // 当切换分页时，内容区域滚动到顶部\n            const ref = tableContentRef.current;\n            if (ref.scrollTo) {\n              ref.scrollTo({ top: 0, left: 0 });\n            } else {\n              // 兼容测试环境或旧浏览器\n              ref.scrollTop = 0;\n              ref.scrollLeft = 0;\n            }\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    innerPagination,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","tableContentRef","pagination","data","disableDataPage","_useConfig","useConfig","classPrefix","_useState","useState","_useState2","_slicedToArray","innerPagination","setInnerPagination","_useState3","_useState4","dataSource","setDataSource","_useState5","_useState6","isPaginateData","setIsPaginateData","isControlled","current","calculatePaginatedData","useCallback","arguments","length","undefined","pageSize","shouldPaginate","Boolean","newData","start","end","_toConsumableArray","slice","updateDataSourceAndPaginate","_calculatePaginatedDa","useEffect","_pagination$pageSize","_pagination$defaultPa","defaultCurrent","defaultPageSize","renderPagination","React","createElement","className","Pagination","_objectSpread","onChange","pageInfo","_props$pagination","_props$pagination$onC","call","_props$onPageChange","_calculatePaginatedDa2","onPageChange","_props$onPageChange2","ref","scrollTo","top","left","scrollTop","scrollLeft"],"mappings":"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"}