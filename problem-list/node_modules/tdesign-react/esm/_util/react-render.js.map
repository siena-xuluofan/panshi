{"version":3,"file":"react-render.js","sources":["../../../components/_util/react-render.ts"],"sourcesContent":["// Implementation reference from: https://github.com/react-component/util/blob/master/src/React/render.ts\nimport type * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport type { Root } from 'react-dom/client';\n\n// Let compiler not to search module usage\nconst fullClone = {\n  ...ReactDOM,\n} as typeof ReactDOM & {\n  __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED?: {\n    usingClientEntryPoint?: boolean;\n  };\n  createRoot?: CreateRoot;\n};\n\ntype CreateRoot = (container: ContainerType) => Root;\n\n// @ts-ignore\nconst { version, render: reactRender, unmountComponentAtNode } = fullClone;\n\nlet legacyCreateRoot: CreateRoot;\nconst mainVersion = Number((version || '').split('.')[0]);\ntry {\n  if (mainVersion >= 18 && mainVersion < 19) {\n    legacyCreateRoot = fullClone.createRoot;\n  }\n} catch (e) {\n  // Do nothing;\n}\n\nfunction toggleWarning(skip: boolean) {\n  const { __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED } = fullClone;\n\n  if (\n    __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED &&\n    typeof __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED === 'object'\n  ) {\n    __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.usingClientEntryPoint = skip;\n  }\n}\n\nfunction react19AdapterWarn() {\n  if (process.env.NODE_ENV === 'development' && mainVersion >= 19 && !legacyCreateRoot) {\n    console.warn(\n      'TDesign warning: Please import react-19-adapter in React 19, See link: https://github.com/Tencent/tdesign-react/blob/develop/packages/tdesign-react/site/docs/getting-started.md#如何在-react-19-中使用',\n    );\n  }\n}\n\nconst MARK = '__td_react_root__';\n\n// ========================== Render ==========================\ntype ContainerType = (Element | DocumentFragment) & {\n  [MARK]?: Root;\n};\n\nfunction modernRender(node: React.ReactElement, container: ContainerType) {\n  toggleWarning(true);\n  const root = container[MARK] || legacyCreateRoot(container);\n  toggleWarning(false);\n\n  root.render(node);\n\n  // eslint-disable-next-line\n  container[MARK] = root;\n}\n\nfunction legacyRender(node: React.ReactElement, container: ContainerType) {\n  reactRender(node, container);\n}\n\nexport function render(node: React.ReactElement, container: ContainerType) {\n  react19AdapterWarn();\n\n  if (legacyCreateRoot) {\n    modernRender(node, container);\n    return;\n  }\n\n  legacyRender?.(node, container);\n}\n\n// ========================= Unmount ==========================\nasync function modernUnmount(container: ContainerType) {\n  // Delay to unmount to avoid React 18 sync warning\n  return Promise.resolve().then(() => {\n    container[MARK]?.unmount();\n\n    // eslint-disable-next-line\n    delete container[MARK];\n  });\n}\n\nfunction legacyUnmount(container: ContainerType) {\n  unmountComponentAtNode(container);\n}\n\nexport async function unmount(container: ContainerType) {\n  if (legacyCreateRoot !== undefined) {\n    // Delay to unmount to avoid React 18 sync warning\n    return modernUnmount(container);\n  }\n\n  legacyUnmount(container);\n}\n\n/**\n * @deprecated Set React render function for compatible usage.\n * This is internal usage only compatible with React 19.\n * And will be removed in next major version.\n */\nexport function renderAdapter(render?: CreateRoot) {\n  if (render) {\n    legacyCreateRoot = render;\n  }\n}\n"],"names":["fullClone","_objectSpread","ReactDOM","version","reactRender","render","unmountComponentAtNode","legacyCreateRoot","mainVersion","Number","split","createRoot","e","toggleWarning","skip","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","_typeof","usingClientEntryPoint","react19AdapterWarn","process","env","NODE_ENV","console","warn","MARK","modernRender","node","container","root","legacyRender","modernUnmount","_callee","_regeneratorRuntime","wrap","_context","prev","next","abrupt","Promise","resolve","then","_container$MARK","unmount","stop","_modernUnmount","apply","arguments","legacyUnmount","_unmount","_asyncToGenerator","mark","_callee2","_context2","renderAdapter"],"mappings":"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"}