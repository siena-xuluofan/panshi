{"version":3,"file":"useMenuContext.js","sources":["../../../../components/menu/hooks/useMenuContext.ts"],"sourcesContent":["import { noop } from 'lodash-es';\nimport { useEffect, useMemo, useState, type ReactNode } from 'react';\nimport { MenuMode, MenuState, SetMenuState } from '../MenuContext';\nimport { MenuTree } from '../_util/getMenuTree';\nimport type { MenuValue, TdHeadMenuProps, TdMenuProps } from '../type';\n\ninterface UseMenuContextProps extends Extract<TdMenuProps, TdHeadMenuProps> {\n  children: ReactNode;\n  mode: MenuMode;\n}\n\nfunction useMenuContext({\n  defaultValue,\n  defaultExpanded,\n  expandMutex,\n  children,\n  onExpand = noop,\n  onChange = noop,\n  value,\n  expanded,\n  collapsed,\n  expandType,\n  theme,\n  mode,\n}: UseMenuContextProps) {\n  const [state, setState] = useState<MenuState>({\n    active: defaultValue,\n    expanded: defaultExpanded,\n  });\n  const setStateValue: SetMenuState = (menuState) => setState({ ...state, ...menuState });\n\n  const menuTree = useMemo(() => new MenuTree(children, expandMutex), [children, expandMutex]);\n\n  useEffect(() => {\n    const currExpanded = expanded || state.expanded || [];\n    menuTree.setExpanded(currExpanded);\n  }, [expanded, state.expanded, menuTree]);\n\n  const handleExpandChange = (value: MenuValue) => {\n    menuTree.expandNode(value);\n    const nextExpanded = menuTree.getExpanded();\n    onExpand(nextExpanded);\n    setState((prevState) => ({\n      ...prevState,\n      expanded: nextExpanded,\n    }));\n  };\n\n  return {\n    value: {\n      onExpand: handleExpandChange,\n      onChange,\n      active: value || state.active,\n      expanded: expanded || state.expanded,\n      collapsed: collapsed || state.collapsed,\n      setState: setStateValue,\n      expandMutex,\n      expandType: collapsed ? 'popup' : expandType,\n      mode,\n      theme,\n    },\n  };\n}\n\nexport default useMenuContext;\n"],"names":["useMenuContext","_ref","defaultValue","defaultExpanded","expandMutex","children","_ref$onExpand","onExpand","noop","_ref$onChange","onChange","value","expanded","collapsed","expandType","theme","mode","_useState","useState","active","_useState2","_slicedToArray","state","setState","setStateValue","menuState","_objectSpread","menuTree","useMemo","MenuTree","useEffect","currExpanded","setExpanded","handleExpandChange","expandNode","nextExpanded","getExpanded","prevState"],"mappings":"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"}