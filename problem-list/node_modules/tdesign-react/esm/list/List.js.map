{"version":3,"file":"List.js","sources":["../../../components/list/List.tsx"],"sourcesContent":["import React, { useImperativeHandle, useMemo, useRef, WheelEvent } from 'react';\nimport classNames from 'classnames';\nimport { compact, isString } from 'lodash-es';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport noop from '../_util/noop';\nimport parseTNode from '../_util/parseTNode';\nimport useConfig from '../hooks/useConfig';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport Loading from '../loading';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport ListItem from './ListItem';\nimport ListItemMeta from './ListItemMeta';\nimport { listDefaultProps } from './defaultProps';\nimport { useListVirtualScroll } from './hooks/useListVirtualScroll';\n\nimport type { StyledProps } from '../common';\nimport type { ListInstanceFunctions, TdListProps } from './type';\n\nexport interface ListProps extends TdListProps, StyledProps {\n  /**\n   * 文本内容\n   */\n  children?: React.ReactNode;\n}\n\n/**\n * 列表组件\n */\nconst List = forwardRefWithStatics(\n  (props: ListProps, ref: React.Ref<ListInstanceFunctions>) => {\n    const {\n      header,\n      footer,\n      asyncLoading,\n      size,\n      split,\n      stripe,\n      layout,\n      children,\n      className,\n      onLoadMore = noop,\n      onScroll = noop,\n      style,\n      scroll,\n    } = useDefaultProps<ListProps>(props, listDefaultProps);\n    const wrapperRef = useRef<HTMLDivElement>(null);\n\n    const { classPrefix } = useConfig();\n    const [local, t] = useLocaleReceiver('list');\n\n    const listItems = useMemo(\n      () => compact(React.Children.map(children, (child: React.ReactElement) => child?.props)) ?? [],\n      [children],\n    );\n\n    const { virtualConfig, cursorStyle, listStyle, isVirtualScroll, onInnerVirtualScroll, scrollToElement } =\n      useListVirtualScroll(scroll, wrapperRef, listItems);\n\n    const COMPONENT_NAME = `${classPrefix}-list`;\n\n    const handleClickLoad = (e: React.MouseEvent<HTMLDivElement>) => {\n      if (asyncLoading === 'load-more') {\n        onLoadMore({ e });\n      }\n    };\n\n    const handleScroll = (event: WheelEvent<HTMLDivElement>): void => {\n      const { currentTarget } = event;\n      const { scrollTop, offsetHeight, scrollHeight } = currentTarget;\n      const scrollBottom = scrollHeight - scrollTop - offsetHeight;\n      if (isVirtualScroll) onInnerVirtualScroll(event as unknown as globalThis.WheelEvent);\n      onScroll({ e: event, scrollTop, scrollBottom });\n    };\n\n    const loadElement = isString(asyncLoading) ? (\n      <div\n        className={classNames(`${classPrefix}-list__load`, {\n          [`${classPrefix}-list__load--loading`]: asyncLoading === 'loading',\n          [`${classPrefix}-list__load--load-more`]: asyncLoading === 'load-more',\n        })}\n        onClick={handleClickLoad}\n      >\n        {asyncLoading === 'loading' && (\n          <div>\n            <Loading loading={true} />\n            <span>{t(local.loadingText)}</span>\n          </div>\n        )}\n        {asyncLoading === 'load-more' && <span>{t(local.loadingMoreText)}</span>}\n      </div>\n    ) : (\n      asyncLoading\n    );\n\n    useImperativeHandle(ref, () => ({\n      scrollTo: scrollToElement,\n    }));\n\n    const renderContent = () => (\n      <>\n        {isVirtualScroll ? (\n          <>\n            <div style={cursorStyle}></div>\n            <ul className={`${COMPONENT_NAME}__inner`} style={listStyle}>\n              {virtualConfig.visibleData.map((item, index) => (\n                <ListItem key={index} {...item} />\n              ))}\n            </ul>\n          </>\n        ) : (\n          <ul className={`${COMPONENT_NAME}__inner`}>{children}</ul>\n        )}\n      </>\n    );\n\n    return (\n      <div\n        ref={wrapperRef}\n        style={{\n          ...style,\n          position: isVirtualScroll ? 'relative' : undefined,\n        }}\n        onScroll={handleScroll}\n        className={classNames(`${COMPONENT_NAME}`, className, {\n          [`${COMPONENT_NAME}--split`]: split,\n          [`${COMPONENT_NAME}--stripe`]: stripe,\n          [`${COMPONENT_NAME}--vertical-action`]: layout === 'vertical',\n          [`${classPrefix}-size-s`]: size === 'small',\n          [`${classPrefix}-size-l`]: size === 'large',\n        })}\n      >\n        {header && <div className={`${COMPONENT_NAME}__header`}>{parseTNode(header)}</div>}\n        {renderContent()}\n        {asyncLoading && loadElement}\n        {footer && <div className={`${COMPONENT_NAME}__footer`}>{parseTNode(footer)}</div>}\n      </div>\n    );\n  },\n  { ListItem, ListItemMeta },\n);\n\nList.displayName = 'List';\n\nexport default List;\n"],"names":["List","forwardRefWithStatics","props","ref","_useDefaultProps","useDefaultProps","listDefaultProps","header","footer","asyncLoading","size","split","stripe","layout","children","className","_useDefaultProps$onLo","onLoadMore","noop","_useDefaultProps$onSc","onScroll","style","scroll","wrapperRef","useRef","_useConfig","useConfig","classPrefix","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","local","t","listItems","useMemo","_compact","compact","React","Children","map","child","_useListVirtualScroll","useListVirtualScroll","virtualConfig","cursorStyle","listStyle","isVirtualScroll","onInnerVirtualScroll","scrollToElement","COMPONENT_NAME","handleClickLoad","e","handleScroll","event","currentTarget","scrollTop","offsetHeight","scrollHeight","scrollBottom","loadElement","isString","createElement","classNames","concat","_defineProperty","onClick","Loading","loading","loadingText","loadingMoreText","useImperativeHandle","scrollTo","renderContent","Fragment","visibleData","item","index","ListItem","_objectSpread","key","position","parseTNode","ListItemMeta","displayName"],"mappings":"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"}