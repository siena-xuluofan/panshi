{"version":3,"file":"Tree.js","sources":["../../../components/tree/Tree.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  MouseEvent,\n  RefObject,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport classNames from 'classnames';\nimport { get } from 'lodash-es';\n\nimport log from '@tdesign/common-js/log/index';\nimport TreeNode from '@tdesign/common-js/tree-v1/tree-node';\nimport type {\n  TreeNodeState,\n  TreeNodeValue,\n  TypeTreeNodeData,\n  TypeTreeNodeModel,\n} from '@tdesign/common-js/tree-v1/types';\n\nimport parseTNode from '../_util/parseTNode';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport { usePersistFn } from '../hooks/usePersistFn';\nimport { treeDefaultProps } from './defaultProps';\nimport { TreeDraggableContext } from './hooks/TreeDraggableContext';\nimport useControllable from './hooks/useControllable';\nimport { useStore } from './hooks/useStore';\nimport { useTreeConfig } from './hooks/useTreeConfig';\nimport useTreeVirtualScroll from './hooks/useTreeVirtualScroll';\nimport TreeItem from './TreeItem';\n\nimport type { ComponentScrollToElementParams, StyledProps, TreeOptionData } from '../common';\nimport type { TreeItemProps } from './interface';\nimport type { TdTreeProps, TreeInstanceFunctions } from './type';\n\nexport type TreeProps = TdTreeProps & StyledProps;\n\nconst Tree = forwardRef<TreeInstanceFunctions<TreeOptionData>, TreeProps>((originalProps, ref) => {\n  const { treeClassNames, transitionNames, transitionClassNames, transitionDuration, locale } = useTreeConfig();\n\n  const { value, onChange, expanded, onExpand, onActive, actived, setTreeIndeterminate, indeterminate } =\n    useControllable(originalProps);\n  const props = useDefaultProps<TreeProps>(originalProps, treeDefaultProps);\n  const {\n    empty,\n    activable,\n    disabled,\n    checkable,\n    checkProps,\n    disableCheck,\n    hover,\n    icon,\n    line,\n    label,\n    operations,\n    transition, // 动画默认开启\n    expandOnClickNode,\n    onClick,\n    scroll,\n    className,\n    style,\n    allowDrop,\n    onScroll,\n  } = props;\n\n  // 可见节点集合\n  const [visibleNodes, setVisibleNodes] = useState([]);\n\n  // 国际化文本初始化\n  const emptyText = empty || locale('empty');\n\n  const store = useStore(\n    {\n      ...props,\n      value,\n      onChange,\n      expanded,\n      onExpand,\n      onActive,\n      actived,\n      indeterminate,\n      setTreeIndeterminate,\n    },\n    initial,\n  );\n\n  function initial() {\n    const nodes = store?.getNodes();\n    const newVisibleNodes = nodes?.filter((node) => node.visible);\n    setVisibleNodes(newVisibleNodes);\n  }\n  // 因为是被 useImperativeHandle 依赖的方法，使用 usePersistFn 变成持久化的。或者也可以使用 useCallback\n  const setExpanded = usePersistFn(\n    (\n      node: TreeNode,\n      isExpanded: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'icon-click' | 'setItem' },\n    ) => {\n      const { e, trigger } = ctx;\n      const expanded = node.setExpanded(isExpanded);\n      const treeNodeModel = node?.getModel();\n      (e || trigger) && onExpand?.(expanded, { node: treeNodeModel, e, trigger });\n      return expanded;\n    },\n  );\n\n  // 因为是被 useImperativeHandle 依赖的方法，使用 usePersistFn 变成持久化的。或者也可以使用 useCallback\n  const setIndeterminate = usePersistFn(\n    (\n      node: TreeNode,\n      isIndeterminate: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'icon-click' | 'setItem' },\n    ) => {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { e, trigger } = ctx;\n      const indeterminate = node.setIndeterminate(isIndeterminate);\n      return indeterminate;\n    },\n  );\n\n  const treeRef = useRef(null);\n\n  const {\n    visibleData,\n    isVirtual,\n    treeNodeStyle: virtualTreeNodeStyle,\n    cursorStyle,\n    handleRowMounted,\n    scrollToElement,\n  } = useTreeVirtualScroll({\n    treeRef,\n    scroll,\n    data: visibleNodes,\n    onScroll,\n  });\n\n  const setActived = usePersistFn(\n    (\n      node: TreeNode,\n      isActived: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'setItem' },\n    ) => {\n      const actived = node.setActived(isActived);\n      const treeNodeModel = node?.getModel();\n      onActive?.(actived, { node: treeNodeModel, ...ctx });\n      return actived;\n    },\n  );\n\n  const setChecked = usePersistFn(\n    (node: TreeNode, isChecked: boolean, ctx: { e?: any; trigger: 'node-click' | 'setItem' }) => {\n      const checked = node.setChecked(isChecked);\n      const treeNodeModel = node?.getModel();\n      onChange?.(checked, { node: treeNodeModel, ...ctx });\n      return checked;\n    },\n  );\n\n  const handleItemClick: TreeItemProps['onClick'] = (node, options) => {\n    if (!node) {\n      return;\n    }\n    const isDisabled = disabled || node.disabled;\n    const { expand, active, e, trigger } = options;\n    if (expand) setExpanded(node, !node.isExpanded(), { e, trigger });\n\n    if (!isDisabled) {\n      const treeNodeModel = node?.getModel();\n      if (active) {\n        setActived(node, !node.isActived(), { e, trigger: 'node-click' });\n        onClick?.({ node: treeNodeModel, e });\n      } else {\n        onClick?.({ node: treeNodeModel, e });\n      }\n    }\n  };\n\n  const handleChange: TreeItemProps['onChange'] = (node, ctx) => {\n    if (!node || disabled || node.disabled) return;\n    const checked = node.toggleChecked();\n    const treeNodeModel = node?.getModel();\n    onChange?.(checked, { node: treeNodeModel, ...ctx, trigger: 'node-click' });\n  };\n\n  const handleScrollToElement = useCallback(\n    (params: ComponentScrollToElementParams) => {\n      let { index } = params;\n\n      if (!index && index !== 0) {\n        if (!params.key) {\n          log.error('Tree', 'scrollToElement: one of `index` or `key` must exist.');\n          return;\n        }\n        const data = visibleNodes;\n        index = data?.findIndex((item) => [get(item.data, 'key'), get(item.data, 'value')].includes(params.key));\n        if (index < 0) {\n          log.error('Tree', `${params.key} does not exist in data, check \\`key\\` or \\`data\\` please.`);\n        }\n      }\n      scrollToElement({ ...params, index });\n    },\n    [scrollToElement, visibleNodes],\n  );\n  /** 对外暴露的公共方法 * */\n  useImperativeHandle<unknown, TreeInstanceFunctions>(\n    ref,\n    () => ({\n      store,\n      scrollTo: (p: ComponentScrollToElementParams) => handleScrollToElement(p),\n      appendTo(value, newData) {\n        let list = [];\n        if (Array.isArray(newData)) {\n          list = newData;\n        } else {\n          list = [newData];\n        }\n        list.forEach((item) => {\n          store.appendNodes(value, item);\n        });\n      },\n      getIndex(value: TreeNodeValue): number {\n        return store.getNodeIndex(value);\n      },\n      getItem(value: TreeNodeValue): TypeTreeNodeModel {\n        const node: TreeNode = store.getNode(value);\n        return node?.getModel();\n      },\n      getItems(value?: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getNodes(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getParent(value: TreeNodeValue): TypeTreeNodeModel {\n        const node = store.getParent(value);\n        return node?.getModel();\n      },\n      getParents(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getParents(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getPath(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const node = store.getNode(value);\n        let pathNodes = [];\n        if (node) {\n          pathNodes = node.getPath().map((node: TreeNode) => node.getModel());\n        }\n        return pathNodes;\n      },\n      insertAfter(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertAfter(value, newData as TypeTreeNodeData);\n      },\n      insertBefore(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertBefore(value, newData as TypeTreeNodeData);\n      },\n      remove(value: TreeNodeValue): void {\n        return store.remove(value);\n      },\n      setItem(value: TreeNodeValue, options: TreeNodeState): void {\n        const node: TreeNode = this.store.getNode(value);\n        const spec = options;\n        if (node && spec) {\n          if ('expanded' in options) {\n            setExpanded(node, spec.expanded, { trigger: 'setItem' });\n            delete spec.expanded;\n          }\n          if ('actived' in options) {\n            setActived(node, spec.actived, { trigger: 'setItem' });\n            delete spec.actived;\n          }\n          if ('checked' in options) {\n            setChecked(node, spec.checked, { trigger: 'setItem' });\n            delete spec.checked;\n          }\n          if ('indeterminate' in options) {\n            // @ts-ignore\n            setTreeIndeterminate((prevIndeterminate: TreeNodeValue[]) => [...prevIndeterminate, value]);\n            setIndeterminate(node, spec.indeterminate, { trigger: 'setItem' });\n            delete spec.indeterminate;\n          }\n          node.set(spec);\n        }\n      },\n    }),\n    [store, setExpanded, setActived, setTreeIndeterminate, setChecked, setIndeterminate, handleScrollToElement],\n  );\n\n  /* ======== render ======= */\n  // https://github.com/reactjs/react-transition-group/issues/668\n  // CSSTransition 不指定 nodeRef 的时候会使用 findDOMNode 获取 dom\n  // 因为 CSSTransition 是个数组，与 visibleNodes 对应，所以这里根据 visibleNodes 的长度创建 ref 用来保存 dom\n  // visibleNodes 改变的时候，释放上一个 nodeList，防止内存泄漏\n  const nodeList = useMemo<RefObject<HTMLDivElement>[]>(\n    () => visibleNodes.map(() => React.createRef()),\n    [visibleNodes],\n  );\n\n  const renderEmpty = () => parseTNode(emptyText);\n\n  const renderItems = (renderNode: TreeNode[]) => {\n    if (renderNode.length <= 0) {\n      return renderEmpty();\n    }\n    if (isVirtual)\n      return (\n        <div className={treeClassNames.treeList} style={virtualTreeNodeStyle}>\n          {renderNode.map((node, index) => (\n            <TreeItem\n              ref={nodeList[index]}\n              key={node.value}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              allowDrop={allowDrop}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n              onTreeItemMounted={handleRowMounted}\n              isVirtual={isVirtual}\n            />\n          ))}\n        </div>\n      );\n\n    return (\n      <TransitionGroup name={transitionNames.treeNode} className={treeClassNames.treeList}>\n        {renderNode.map((node, index) => (\n          // https://github.com/reactjs/react-transition-group/issues/668\n          <CSSTransition\n            nodeRef={nodeList[index]}\n            key={node.value}\n            timeout={transitionDuration}\n            classNames={transitionClassNames}\n          >\n            <TreeItem\n              ref={nodeList[index]}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              allowDrop={allowDrop}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n            />\n          </CSSTransition>\n        ))}\n      </TransitionGroup>\n    );\n  };\n\n  const draggable = useMemo(\n    () => ({\n      props,\n      store,\n    }),\n    [props, store],\n  );\n\n  return (\n    <TreeDraggableContext.Provider value={draggable}>\n      <div\n        className={classNames(treeClassNames.tree, className, {\n          [treeClassNames.disabled]: disabled,\n          [treeClassNames.treeHoverable]: hover,\n          [treeClassNames.treeCheckable]: checkable,\n          [treeClassNames.treeFx]: transition,\n          [treeClassNames.treeBlockNode]: expandOnClickNode,\n          [treeClassNames.treeVscroll]: props.scroll, // 开启虚拟滚动就要有overflow 否则低于 threshold 无法正常运行 scrollto\n        })}\n        style={style}\n        ref={treeRef}\n      >\n        {isVirtual ? (\n          <>\n            <div className={treeClassNames.treeVscrollCursor} style={cursorStyle} />\n            {renderItems(visibleData)}\n          </>\n        ) : (\n          renderItems(visibleNodes)\n        )}\n      </div>\n    </TreeDraggableContext.Provider>\n  );\n});\n\nTree.displayName = 'Tree';\n\nexport default Tree;\n"],"names":["Tree","forwardRef","originalProps","ref","_useTreeConfig","useTreeConfig","treeClassNames","transitionNames","transitionClassNames","transitionDuration","locale","_useControllable","useControllable","value","onChange","expanded","onExpand","onActive","actived","setTreeIndeterminate","indeterminate","props","useDefaultProps","treeDefaultProps","empty","activable","disabled","checkable","checkProps","disableCheck","hover","icon","line","label","operations","transition","expandOnClickNode","onClick","scroll","className","style","allowDrop","onScroll","_useState","useState","_useState2","_slicedToArray","visibleNodes","setVisibleNodes","emptyText","store","useStore","_objectSpread","initial","nodes","getNodes","newVisibleNodes","filter","node","visible","setExpanded","usePersistFn","isExpanded","ctx","e","trigger","treeNodeModel","getModel","setIndeterminate","isIndeterminate","treeRef","useRef","_useTreeVirtualScroll","useTreeVirtualScroll","data","visibleData","isVirtual","virtualTreeNodeStyle","treeNodeStyle","cursorStyle","handleRowMounted","scrollToElement","setActived","isActived","setChecked","isChecked","checked","handleItemClick","options","isDisabled","expand","active","handleChange","toggleChecked","handleScrollToElement","useCallback","params","index","key","log","error","findIndex","item","get","includes","concat","useImperativeHandle","scrollTo","p","appendTo","newData","list","Array","isArray","forEach","appendNodes","getIndex","getNodeIndex","getItem","getNode","getItems","map","getParent","getParents","getPath","pathNodes","insertAfter","insertBefore","remove","setItem","spec","prevIndeterminate","_toConsumableArray","set","nodeList","useMemo","React","createRef","renderEmpty","parseTNode","renderItems","renderNode","length","createElement","treeList","TreeItem","keys","onTreeItemMounted","TransitionGroup","name","treeNode","CSSTransition","nodeRef","timeout","classNames","draggable","TreeDraggableContext","Provider","tree","_defineProperty","treeHoverable","treeCheckable","treeFx","treeBlockNode","treeVscroll","treeVscrollCursor","displayName"],"mappings":"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"}