{"version":3,"file":"index.js","sources":["../../../../components/form/utils/index.ts"],"sourcesContent":["import { get, has, isArray, isEmpty, isObject } from 'lodash-es';\nimport type { FormItemInstance } from '../FormItem';\nimport type { NamePath } from '../type';\n\n/**\n * 在 `formMap` 中查找指定的 `FormItem`\n * (仅查找当前层级)\n */\nexport function findFormItem(\n  name: NamePath,\n  formMapRef: React.MutableRefObject<Map<any, any>>,\n): React.RefObject<FormItemInstance> | undefined {\n  if (!formMapRef.current) return;\n  // 提取所有 map key\n  const mapKeys = [...formMapRef.current.keys()];\n  // 转译为字符串后比对 key 兼容数组格式\n  const key = mapKeys.find((key) => String(key) === String(name));\n  // 拿到 key 引用地址获取 value\n  return formMapRef.current.get(key);\n}\n\n/**\n * 在 `formMap` 中查找指定的 `FormItem`\n * (包括在嵌套的 FormList 中递归查找）\n */\nexport function findFormItemDeep(\n  name: NamePath,\n  formMapRef: React.MutableRefObject<Map<any, any>>,\n): React.RefObject<FormItemInstance> | undefined {\n  if (!formMapRef?.current) return;\n  const targetPath = Array.isArray(name) ? name : [name];\n  for (const [key, ref] of formMapRef.current.entries()) {\n    const formItem = ref?.current;\n    if (!formItem?.isFormList || !formItem.formListMapRef) continue;\n    const { formListMapRef } = formItem;\n    for (const [itemKey, itemRef] of formListMapRef.current.entries()) {\n      const fullPath = [key, itemKey].flat();\n      if (String(fullPath) === String(targetPath)) return itemRef;\n    }\n    const found = findFormItemDeep(name, formListMapRef);\n    if (found) return found;\n  }\n}\n\n// { user: { name: '' } } => [['user', 'name']]\n// 不处理数组类型\n// { user: [{ name: '' }]} => [['user']]\nexport function objectToArray(obj: Record<string | number, any>) {\n  const result: (string | number)[][] = [];\n\n  function traverse(current: any, path: string[] = []) {\n    if (isObject(current) && !isArray(current) && !isEmpty(current)) {\n      Object.keys(current).forEach((key) => {\n        traverse(current[key], [...path, key]);\n      });\n    } else {\n      result.push(path);\n    }\n  }\n\n  traverse(obj);\n  return result;\n}\n\n// 将数据整理成对象，数组 name 转化嵌套对象: ['user', 'name'] => { user: { name: '' } }\nexport function calcFieldValue(name: NamePath, value: any, isFormList = true) {\n  if (Array.isArray(name)) {\n    if (isFormList) {\n      const fieldValue = name.reduceRight((prev, curr) => {\n        const arr = [];\n        if (/^\\d+$/.test(String(curr))) arr[curr] = prev;\n        return arr.length ? arr : { [curr]: prev };\n      }, value);\n      return { ...fieldValue };\n    }\n    return name.reduceRight((prev, curr, currentIndex) => {\n      if (currentIndex === name.length - 1) {\n        return { [curr]: value };\n      }\n      return { [curr]: prev };\n    }, {});\n  }\n\n  return { [name]: value };\n}\n\n// 通过对象数据类型获取 map 引用: { user: { name: '' } } => formMap.get(['user', 'name'])\nexport function travelMapFromObject(\n  obj: Record<any, any>,\n  formMapRef: React.MutableRefObject<Map<any, any>>,\n  callback: Function,\n) {\n  for (const [mapName, formItemRef] of formMapRef.current.entries()) {\n    if (has(obj, mapName)) {\n      callback(formItemRef, get(obj, mapName));\n    }\n  }\n}\n"],"names":["findFormItem","name","formMapRef","current","mapKeys","keys","key","find","String","get","findFormItemDeep","targetPath","Array","isArray","_iterator","_createForOfIteratorHelper","entries","_step","s","n","done","_step$value","_slicedToArray","value","ref","formItem","isFormList","formListMapRef","_iterator2","_step2","_step2$value","itemKey","itemRef","fullPath","flat","err","e","f","found","objectToArray","obj","result","traverse","path","arguments","length","undefined","isObject","isEmpty","Object","forEach","concat","_toConsumableArray","push","calcFieldValue","fieldValue","reduceRight","prev","curr","arr","test","_defineProperty","_objectSpread","currentIndex","travelMapFromObject","callback","_iterator3","_step3","_step3$value","mapName","formItemRef","has"],"mappings":"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"}