{"version":3,"file":"SelectInput.js","sources":["../../../components/select-input/SelectInput.tsx"],"sourcesContent":["import React, { useImperativeHandle, useRef } from 'react';\n\nimport classNames from 'classnames';\n\nimport useConfig from '../hooks/useConfig';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport Popup, { type PopupRef, type PopupVisibleChangeContext } from '../popup';\nimport { selectInputDefaultProps } from './defaultProps';\nimport useMultiple from './useMultiple';\nimport useOverlayInnerStyle from './useOverlayInnerStyle';\nimport useSingle from './useSingle';\n\nimport type { StyledProps } from '../common';\nimport type { InputRef } from '../input';\nimport type { TdSelectInputProps } from './type';\n\nexport interface SelectInputProps extends TdSelectInputProps, StyledProps {\n  updateScrollTop?: (content: HTMLDivElement) => void;\n  options?: any[]; // 参数穿透options, 给SelectInput/SelectInput 自定义选中项呈现的内容和多选状态下设置折叠项内容\n}\n\nconst SelectInput = React.forwardRef<Partial<PopupRef & InputRef>, SelectInputProps>((originalProps, ref) => {\n  const { classPrefix: prefix } = useConfig();\n\n  const props = useDefaultProps<SelectInputProps>(originalProps, selectInputDefaultProps);\n  const { multiple, value, popupVisible, popupProps, borderless, disabled } = props;\n\n  const selectInputRef = useRef<PopupRef>(null);\n  const selectInputWrapRef = useRef<HTMLDivElement>(null);\n\n  const { commonInputProps, inputRef, singleInputValue, onInnerClear, renderSelectSingle } = useSingle(props);\n  const { tagInputRef, tags, multipleInputValue, renderSelectMultiple } = useMultiple(props);\n\n  const { tOverlayInnerStyle, innerPopupVisible, onInnerPopupVisibleChange, skipNextBlur } = useOverlayInnerStyle(\n    props,\n    {\n      afterHidePopup: onInnerBlur,\n    },\n  );\n\n  const popupClasses = classNames([\n    props.className,\n    `${prefix}-select-input`,\n    {\n      [`${prefix}-select-input--borderless`]: borderless,\n      [`${prefix}-select-input--multiple`]: multiple,\n      [`${prefix}-select-input--popup-visible`]: popupVisible ?? innerPopupVisible,\n      [`${prefix}-select-input--empty`]: value instanceof Array ? !value.length : !value,\n    },\n  ]);\n\n  useImperativeHandle(ref, () => ({\n    ...(selectInputRef.current || {}),\n    ...(inputRef.current || {}),\n    ...(tagInputRef.current || {}),\n  }));\n\n  // 浮层显示的受控与非受控\n  const visibleProps = { visible: popupVisible ?? innerPopupVisible };\n\n  /* SelectInput 与普通 Input 的 blur 事件触发时机不同\n    该组件的 blur 事件在 popup 隐藏时才触发，避免点击浮层内容时触发 blur 事件 */\n  function onInnerBlur(ctx: PopupVisibleChangeContext) {\n    if (skipNextBlur.current) return;\n    const inputValue = props.multiple ? multipleInputValue : singleInputValue;\n    const params: Parameters<TdSelectInputProps['onBlur']>[1] = {\n      e: ctx.e,\n      inputValue,\n      ...(props.multiple && { tagInputValue: tags }),\n    };\n    props.onBlur?.(props.value, params);\n  }\n\n  // TODO: Popup trigger need to support array. both click and focus can open panel\n  const mainContent = (\n    <div className={popupClasses} style={props.style}>\n      <Popup\n        ref={selectInputRef}\n        trigger={popupProps?.trigger || 'click'}\n        placement=\"bottom-left\"\n        content={props.panel}\n        hideEmptyPopup={true}\n        onVisibleChange={onInnerPopupVisibleChange}\n        updateScrollTop={props.updateScrollTop}\n        {...visibleProps}\n        {...popupProps}\n        disabled={disabled}\n        overlayInnerStyle={tOverlayInnerStyle}\n      >\n        {multiple\n          ? renderSelectMultiple({\n              commonInputProps,\n              popupVisible: visibleProps.visible,\n              allowInput: props.allowInput,\n              onInnerClear,\n              onInnerBlur,\n            })\n          : renderSelectSingle(visibleProps.visible, onInnerBlur)}\n      </Popup>\n    </div>\n  );\n\n  if (!props.tips) {\n    return mainContent;\n  }\n\n  return (\n    <div ref={selectInputWrapRef} className={`${prefix}-select-input__wrap`}>\n      {mainContent}\n      {props.tips && (\n        <div className={`${prefix}-input__tips ${prefix}-input__tips--${props.status || 'normal'}`}>{props.tips}</div>\n      )}\n    </div>\n  );\n});\n\nSelectInput.displayName = 'SelectInput';\n\nexport default SelectInput;\n"],"names":["SelectInput","React","forwardRef","originalProps","ref","_useConfig","useConfig","prefix","classPrefix","props","useDefaultProps","selectInputDefaultProps","multiple","value","popupVisible","popupProps","borderless","disabled","selectInputRef","useRef","selectInputWrapRef","_useSingle","useSingle","commonInputProps","inputRef","singleInputValue","onInnerClear","renderSelectSingle","_useMultiple","useMultiple","tagInputRef","tags","multipleInputValue","renderSelectMultiple","_useOverlayInnerStyle","useOverlayInnerStyle","afterHidePopup","onInnerBlur","tOverlayInnerStyle","innerPopupVisible","onInnerPopupVisibleChange","skipNextBlur","popupClasses","classNames","className","concat","_defineProperty","Array","length","useImperativeHandle","_objectSpread","current","visibleProps","visible","ctx","_props$onBlur","inputValue","params","e","tagInputValue","onBlur","call","mainContent","createElement","style","Popup","trigger","placement","content","panel","hideEmptyPopup","onVisibleChange","updateScrollTop","overlayInnerStyle","allowInput","tips","status","displayName"],"mappings":"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"}