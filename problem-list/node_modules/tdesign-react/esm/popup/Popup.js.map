{"version":3,"file":"Popup.js","sources":["../../../components/popup/Popup.tsx"],"sourcesContent":["import { Placement, type Options } from '@popperjs/core';\nimport classNames from 'classnames';\nimport { debounce, isFunction } from 'lodash-es';\nimport React, { forwardRef, useEffect, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport { getRefDom } from '../_util/ref';\nimport { getCssVarsValue } from '../_util/style';\nimport Portal from '../common/Portal';\nimport useAnimation from '../hooks/useAnimation';\nimport useAttach from '../hooks/useAttach';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport useMutationObserver from '../hooks/useMutationObserver';\nimport usePopper from '../hooks/usePopper';\nimport useWindowSize from '../hooks/useWindowSize';\nimport { popupDefaultProps } from './defaultProps';\nimport useTrigger from './hooks/useTrigger';\nimport type { TdPopupProps } from './type';\nimport { getTransitionParams } from './utils/transition';\n\nexport interface PopupProps extends TdPopupProps {\n  // 是否触发展开收起动画，内部下拉式组件使用\n  expandAnimation?: boolean;\n  // 更新内容区域滚动条\n  updateScrollTop?: (content: HTMLDivElement) => void;\n}\n\nexport interface PopupRef {\n  /** 获取 popper 实例 */\n  getPopper: () => ReturnType<typeof usePopper>;\n  /** 获取 Popup dom 元素 */\n  getPopupElement: () => HTMLDivElement;\n  /** 获取 portal dom 元素 */\n  getPortalElement: () => HTMLDivElement;\n  /** 获取内容区域 dom 元素 */\n  getPopupContentElement: () => HTMLDivElement;\n  /** 设置 popup 显示隐藏 */\n  setVisible: (visible: boolean) => void;\n}\n\nconst Popup = forwardRef<PopupRef, PopupProps>((originalProps, ref) => {\n  const props = useDefaultProps<PopupProps>(originalProps, popupDefaultProps);\n  const {\n    trigger,\n    content,\n    placement,\n    attach,\n    showArrow,\n    destroyOnClose,\n    overlayClassName,\n    overlayInnerClassName,\n    overlayStyle,\n    overlayInnerStyle,\n    triggerElement,\n    children = triggerElement,\n    disabled,\n    zIndex,\n    onScroll,\n    onScrollToBottom,\n    expandAnimation,\n    delay,\n    hideEmptyPopup,\n    updateScrollTop,\n  } = props;\n  const { classPrefix } = useConfig();\n  const popupAttach = useAttach('popup', attach);\n\n  // 全局配置\n  const { keepExpand, keepFade } = useAnimation();\n  const { height: windowHeight, width: windowWidth } = useWindowSize();\n  const [visible, onVisibleChange] = useControlled(props, 'visible', props.onVisibleChange);\n\n  const [popupElement, setPopupElement] = useState(null);\n  const triggerRef = useRef(null); // 记录 trigger 元素\n  const popupRef = useRef(null); // popup dom 元素，css transition 需要用\n  const portalRef = useRef(null); // portal dom 元素\n  const contentRef = useRef(null); // 内容部分\n  const popperRef = useRef(null); // 保存 popper 实例\n\n  // 默认动画时长\n  const DEFAULT_TRANSITION_TIMEOUT = 180;\n\n  // 处理切换 panel 为 null 和正常内容动态切换的情况\n  useEffect(() => {\n    if (!content && hideEmptyPopup) {\n      requestAnimationFrame(() => setPopupElement(null));\n    }\n  }, [content, hideEmptyPopup]);\n\n  // 判断展示浮层\n  const showOverlay = useMemo(() => {\n    if (hideEmptyPopup && !content) return false;\n    return visible || popupElement;\n  }, [hideEmptyPopup, content, visible, popupElement]);\n\n  // 转化 placement\n  const popperPlacement = useMemo(\n    () => placement.replace(/-(left|top)$/, '-start').replace(/-(right|bottom)$/, '-end') as Placement,\n    [placement],\n  );\n\n  const { getTriggerNode, getPopupProps, getTriggerDom } = useTrigger({\n    triggerRef,\n    content,\n    disabled,\n    trigger,\n    visible,\n    delay,\n    onVisibleChange,\n  });\n\n  const popperOptions = props.popperOptions as Options;\n  popperRef.current = usePopper(getRefDom(triggerRef), popupElement, {\n    placement: popperPlacement,\n    ...popperOptions,\n  });\n  /**\n   * 是否启用 popper.js 的 arrow 修饰符\n   * - 会自动根据属性 data-popper-arrow 来识别箭头元素\n   * - 从而支持使用 padding 调整箭头位置\n   * @ see https://popper.js.org/docs/v2/modifiers/arrow/\n   */\n  const hasArrowModifier = popperOptions?.modifiers?.some((modifier) => modifier.name === 'arrow');\n  const { styles, attributes } = popperRef.current;\n\n  const triggerNode = isFunction(children) ? getTriggerNode(children({ visible })) : getTriggerNode(children);\n\n  const updateTimeRef = useRef(null);\n  // 监听 trigger 节点或内容变化动态更新 popup 定位\n  useMutationObserver(getRefDom(triggerRef), () => {\n    const isDisplayNone = getCssVarsValue('display', getRefDom(triggerRef)) === 'none';\n    if (visible && !isDisplayNone) {\n      clearTimeout(updateTimeRef.current);\n      updateTimeRef.current = setTimeout(() => popperRef.current?.update?.(), 0);\n    }\n  });\n  useEffect(() => () => clearTimeout(updateTimeRef.current), []);\n\n  // 窗口尺寸变化时调整位置\n  useEffect(() => {\n    if (visible) {\n      requestAnimationFrame(() => popperRef.current?.update?.());\n    }\n  }, [visible, content, windowHeight, windowWidth]);\n\n  // 下拉展开时更新内部滚动条\n  useEffect(() => {\n    if (!triggerRef.current) triggerRef.current = getTriggerDom();\n    if (visible) {\n      updateScrollTop?.(contentRef.current);\n    }\n  }, [visible, updateScrollTop, getTriggerDom]);\n\n  function handleExited() {\n    !destroyOnClose && popupElement && (popupElement.style.display = 'none');\n  }\n  function handleEnter() {\n    !destroyOnClose && popupElement && (popupElement.style.display = 'block');\n  }\n\n  function handleScroll(e: React.WheelEvent<HTMLDivElement>) {\n    onScroll?.({ e });\n\n    // 防止多次触发添加截流\n    const debounceOnScrollBottom = debounce((e) => onScrollToBottom?.({ e }), 100);\n\n    const { scrollTop, clientHeight, scrollHeight } = e.target as HTMLDivElement;\n    // windows 下滚动会出现小数，所以这里取整\n    if (clientHeight + Math.floor(scrollTop) === scrollHeight) {\n      // touch bottom\n      debounceOnScrollBottom(e);\n    }\n  }\n\n  // 整理浮层样式\n  function getOverlayStyle(overlayStyle: TdPopupProps['overlayStyle']) {\n    if (getRefDom(triggerRef) && popupRef.current && typeof overlayStyle === 'function') {\n      return { ...overlayStyle(getRefDom(triggerRef), popupRef.current) };\n    }\n    return { ...overlayStyle };\n  }\n\n  const overlay = showOverlay && (\n    <CSSTransition\n      appear\n      in={visible}\n      timeout={DEFAULT_TRANSITION_TIMEOUT}\n      nodeRef={portalRef}\n      unmountOnExit={destroyOnClose}\n      onEnter={handleEnter}\n      onExited={handleExited}\n    >\n      <Portal triggerNode={getRefDom(triggerRef)} attach={popupAttach} ref={portalRef}>\n        <CSSTransition\n          appear\n          timeout={0}\n          in={visible}\n          nodeRef={popupRef}\n          {...getTransitionParams({\n            classPrefix,\n            fadeAnimation: keepFade,\n            expandAnimation: expandAnimation && keepExpand,\n          })}\n        >\n          <div\n            ref={(node) => {\n              if (node) {\n                popupRef.current = node;\n                setPopupElement(node);\n              }\n            }}\n            style={{ ...styles.popper, zIndex, ...getOverlayStyle(overlayStyle) }}\n            className={classNames(`${classPrefix}-popup`, overlayClassName)}\n            {...attributes.popper}\n            {...getPopupProps()}\n            onClick={(e) => props.onOverlayClick?.({ e })}\n          >\n            <div\n              ref={contentRef}\n              className={classNames(\n                `${classPrefix}-popup__content`,\n                {\n                  [`${classPrefix}-popup__content--arrow`]: showArrow,\n                },\n                overlayInnerClassName,\n              )}\n              style={getOverlayStyle(overlayInnerStyle)}\n              onScroll={handleScroll}\n            >\n              {content}\n              {showArrow && (\n                <div\n                  style={styles.arrow}\n                  className={`${classPrefix}-popup__arrow`}\n                  {...(hasArrowModifier && { 'data-popper-arrow': '' })}\n                />\n              )}\n            </div>\n          </div>\n        </CSSTransition>\n      </Portal>\n    </CSSTransition>\n  );\n\n  useImperativeHandle(ref, () => ({\n    getPopper: () => popperRef.current,\n    getPopupElement: () => popupRef.current,\n    getPortalElement: () => portalRef.current,\n    getPopupContentElement: () => contentRef.current,\n    setVisible: (visible: boolean) => onVisibleChange(visible, { trigger: 'document' }),\n  }));\n\n  return (\n    <React.Fragment>\n      {triggerNode}\n      {overlay}\n    </React.Fragment>\n  );\n});\n\nPopup.displayName = 'Popup';\n\nexport default Popup;\n"],"names":["Popup","forwardRef","originalProps","ref","_popperOptions$modifi","props","useDefaultProps","popupDefaultProps","trigger","content","placement","attach","showArrow","destroyOnClose","overlayClassName","overlayInnerClassName","overlayStyle","overlayInnerStyle","triggerElement","_props$children","children","disabled","zIndex","onScroll","onScrollToBottom","expandAnimation","delay","hideEmptyPopup","updateScrollTop","_useConfig","useConfig","classPrefix","popupAttach","useAttach","_useAnimation","useAnimation","keepExpand","keepFade","_useWindowSize","useWindowSize","windowHeight","height","windowWidth","width","_useControlled","useControlled","onVisibleChange","_useControlled2","_slicedToArray","visible","_useState","useState","_useState2","popupElement","setPopupElement","triggerRef","useRef","popupRef","portalRef","contentRef","popperRef","DEFAULT_TRANSITION_TIMEOUT","useEffect","requestAnimationFrame","showOverlay","useMemo","popperPlacement","replace","_useTrigger","useTrigger","getTriggerNode","getPopupProps","getTriggerDom","popperOptions","current","usePopper","getRefDom","_objectSpread","hasArrowModifier","modifiers","some","modifier","name","_popperRef$current","styles","attributes","triggerNode","isFunction","updateTimeRef","useMutationObserver","isDisplayNone","getCssVarsValue","clearTimeout","setTimeout","_popperRef$current2","_popperRef$current2$u","update","call","_popperRef$current3","_popperRef$current3$u","handleExited","style","display","handleEnter","handleScroll","e","debounceOnScrollBottom","debounce","_e$target","target","scrollTop","clientHeight","scrollHeight","Math","floor","getOverlayStyle","overlay","React","createElement","CSSTransition","appear","timeout","nodeRef","unmountOnExit","onEnter","onExited","Portal","getTransitionParams","fadeAnimation","node","popper","className","classNames","concat","onClick","_props$onOverlayClick","onOverlayClick","_defineProperty","arrow","useImperativeHandle","getPopper","getPopupElement","getPortalElement","getPopupContentElement","setVisible","Fragment","displayName"],"mappings":"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"}